(function(d,a,e,f){var c=function(o,C,A){var j,u,y,n,x,l,k,B;n=Math.floor(o*6);x=o*6-n;l=A*(1-C);k=A*(1-x*C);B=A*(1-(1-x)*C);switch(n%6){case 0:j=A,u=B,y=l;break;case 1:j=k,u=A,y=l;break;case 2:j=l,u=A,y=B;break;case 3:j=l,u=k,y=A;break;case 4:j=B,u=l,y=A;break;case 5:j=A,u=l,y=k;break}var z=Math.floor(j*255).toString(16);var m=Math.floor(u*255).toString(16);var w=Math.floor(y*255).toString(16);return"#"+(z.length<2?"0":"")+z+(m.length<2?"0":"")+m+(w.length<2?"0":"")+w};var b=function(C,E,m,k,D,j,t,I,h,r,n,i,o,G){var A=function(L,M){if(!M){}else{if(L.getSelectedHTML()){L.insertLink(M)}else{L.insertHTML('<a href="'+M.replace(/"/,"&quot;")+'">'+M+"</a>")}}L.closePopup().collapseSelection()};var F=function(L,P){var O=z(j);var Q=e('<input type="text" value="'+(P?P.attr("href"):"")+'" />').addClass("wysiwyg-input").keypress(function(R){if(R.which!=10&&R.which!=13){return}if(P){P.attr("href",Q.val());L.closePopup().collapseSelection()}else{try{A(L,Q.val())}catch(S){L.closePopup()}}});if(I){Q.attr("placeholder",I)}var N=O.click(function(R){if(P){P.attr("href",Q.val());L.closePopup().collapseSelection()}else{A(L,Q.val())}R.stopPropagation();R.preventDefault();return false});var M=e("<div/>").addClass("wysiwyg-toolbar-form").attr("unselectable","on");M.append(Q).append(N);return M};var y=function(P){var N=function(W,V){var X='<img id="wysiwyg-insert-image" src="" alt=""'+(V?' title="'+V.replace(/"/,"&quot;")+'"':"")+" />";P.insertHTML(X).closePopup().collapseSelection();var Y=e("#wysiwyg-insert-image").removeAttr("id");if(r){Y.css({maxWidth:r[0]+"px",maxHeight:r[1]+"px"}).load(function(){Y.css({maxWidth:"",maxHeight:""});var aa=Y.width(),Z=Y.height();if(aa>r[0]||Z>r[1]){if((aa/Z)>(r[0]/r[1])){Z=parseInt(Z/aa*r[0]);aa=r[0]}else{aa=parseInt(aa/Z*r[1]);Z=r[1]}Y.attr("width",aa).attr("height",Z)}})}Y.attr("src",W)};var O=e("<div/>").addClass("wysiwyg-toolbar-form").attr("unselectable","on");var S=null,U=e('<input type="file" />').css({position:"absolute",left:0,top:0,width:"100%",height:"100%",opacity:0,cursor:"pointer"});if(!i&&d.File&&d.FileReader&&d.FileList){var Q=function(W){if(!W.type.match("image.*")){return}var V=new FileReader();V.onload=function(Y){var X=Y.target.result;N(X,W.name)};V.readAsDataURL(W)};S=U.attr("draggable","true").change(function(X){var W=X.target.files;for(var V=0;V<W.length;++V){Q(W[V])}}).on("dragover",function(V){V.originalEvent.dataTransfer.dropEffect="copy";V.stopPropagation();V.preventDefault();return false}).on("drop",function(X){var W=X.originalEvent.dataTransfer.files;for(var V=0;V<W.length;++V){Q(W[V])}X.stopPropagation();X.preventDefault();return false})}else{if(n){var T=U.change(function(V){n.call(this,N)});S=e("<form/>").append(T)}}if(S){e("<div/>").addClass("wysiwyg-browse").html(t).append(S).appendTo(O)}var L=z(j);var R=e('<input type="text" value="" />').addClass("wysiwyg-input").keypress(function(V){if(V.which==10||V.which==13){N(R.val())}});if(I){R.attr("placeholder",I)}var M=L.click(function(V){N(R.val());V.stopPropagation();V.preventDefault();return false});O.append(e("<div/>").append(R).append(M));return O};var H=function(L){var O=function(S,T){S=e.trim(S||"");T=e.trim(T||"");var U=false;if(S.length&&!T.length){U=S}else{if(T.indexOf("<")==-1&&T.indexOf(">")==-1&&T.match(/^(?:https?:\/)?\/?(?:[^:\/\s]+)(?:(?:\/\w+)*\/)(?:[\w\-\.]+[^#?\s]+)(?:.*)?(?:#[\w\-]+)?$/)){U=T}}if(U&&o){T=o(U)||""}if(!T.length&&U){T='<video src="'+U.replace(/"/,"&quot;")+'" />'}L.insertHTML(T).closePopup().collapseSelection()};var M=e("<div/>").addClass("wysiwyg-toolbar-form").attr("unselectable","on");var N=e("<textarea>").addClass("wysiwyg-input wysiwyg-inputtextarea");if(h){N.attr("placeholder",h)}e("<div/>").addClass("wysiwyg-embedcode").append(N).appendTo(M);var Q=z(j);var R=e('<input type="text" value="" />').addClass("wysiwyg-input").keypress(function(S){if(S.which==10||S.which==13){O(R.val())}});if(I){R.attr("placeholder",I)}var P=Q.click(function(S){O(R.val(),N.val());S.stopPropagation();S.preventDefault();return false});M.append(e("<div/>").append(R).append(P));return M};var s=function(M,O){var L=e("<table/>").attr("cellpadding","0").attr("cellspacing","0").attr("unselectable","on");
for(var W=1;W<15;++W){var U=e("<tr/>");for(var N=0;N<25;++N){var P;if(N==24){var V=Math.floor(255/13*(14-W)).toString(16);var S=(V.length<2?"0":"")+V;P="#"+S+S+S}else{var R=N/24;var Q=W<=8?W/8:1;var T=W>8?(16-W)/8:1;P=c(R,Q,T)}e("<td/>").addClass("wysiwyg-toolbar-color").attr("title",P).attr("unselectable","on").css({backgroundColor:P}).click(function(){var X=this.title;if(O){M.forecolor(X).closePopup().collapseSelection()}else{M.highlight(X).closePopup().collapseSelection()}return false}).appendTo(U)}L.append(U)}return L};var v=function(L,M){switch(L){case"insertimage":if(!M){return null}return function(N){M(y(g),N)};case"insertvideo":if(!M){return null}return function(N){M(H(g),N)};case"insertlink":if(!M){return null}return function(N){M(F(g),N)};case"bold":return function(){g.bold()};case"italic":return function(){g.italic()};case"underline":return function(){g.underline()};case"strikethrough":return function(){g.strikethrough()};case"forecolor":if(!M){return null}return function(N){M(s(g,true),N)};case"highlight":if(!M){return null}return function(N){M(s(g,false),N)};case"alignleft":return function(){g.align("left")};case"aligncenter":return function(){g.align("center")};case"alignright":return function(){g.align("right")};case"alignjustify":return function(){g.align("justify")};case"subscript":return function(){g.subscript()};case"superscript":return function(){g.superscript()};case"indent":return function(){g.indent()};case"outdent":return function(){g.indent(true)};case"orderedList":return function(){g.insertList(true)};case"unorderedList":return function(){g.insertList()};case"removeformat":return function(){g.removeFormat().closePopup().collapseSelection()}}return null};var z=function(L){return e("<a/>").addClass("wysiwyg-toolbar-icon").attr("href","#").attr("title",L.title).attr("unselectable","on").append(L.image)};var B=function(L,M,N,O){e.each(D,function(P,S){if(!S){return}if(M===false&&"showstatic" in S&&!S.showstatic){return}if(M===true&&"showselection" in S&&!S.showselection){return}var R;if("click" in S){R=function(T){S.click(e(T))}}else{if("popup" in S){R=function(U){var V=N();var T=S.popup(V,e(U));O(V,U,T)}}else{R=v(P,function(T,U){var V=N();V.append(T);O(V,U);V.find("input[type=text]:first").focus()})}}var Q;if(R){Q=z(S).click(function(T){R(T.currentTarget);if(v(P)){g.getElement().focus()}T.stopPropagation();T.preventDefault();return false})}else{if(S.html){Q=e(S.html)}}if(Q){L.append(Q)}})};var K=function(L,Z,P,W){var Y=Z.get(0).offsetParent,R={left:0,top:0},U=false,M=false,X=L.width(),O=Y;while(O){R.left+=O.offsetLeft;R.top+=O.offsetTop;var N=e(O);if(N.css("position")=="fixed"){U=true}if(N.css("overflow")!="visible"){M=true}O=O.offsetParent}var V=e(Y||a.body);V.append(L);var Q=Z.position();P+=Q.left;W+=Q.top;if(U||M){if(P+X>V.width()-1){P=V.width()-X-1}if(P<1){P=1}}var T=e(d).width();if(R.left+P+X>T-1){P=T-R.left-X-1}var S=U?0:e(d).scrollLeft();if(R.left+P<S+1){P=S-R.left+1}L.css({left:parseInt(P)+"px",top:parseInt(W)+"px"})};var q={};var u=function(Q,P,O){var N={element:Q.get(0),onkeypress:function(T,V,S,U,X,W){if(G&&G(T,V,S,U,X,W)===false){return false}if(V&&!S&&!U&&X&&!W){var R=V.toLowerCase();if(!q[R]){return}q[R]();return false}},onselection:function(Y,V,S,T){var U=true,R=null;if(Y){e.each(S,function(Z,aa){if(e(aa).parents("a").length!=0){R=F(L,e(aa).parents("a:first"));return false}})}if(!V){U=false}else{if(R){}else{if(T){}else{if(k!="selection"&&k!="top-selection"&&k!="bottom-selection"){U=false}else{if(Y){U=false}else{if(S.length==1&&S[0].nodeName=="IMG"){U=false}}}}}}if(!U){L.closePopup();return}var X;var W=function(){var ad=X.outerWidth();var ac=P.offset(),Z=e(L.getElement()).offset();var ab=V.left+parseInt(V.width/2)-parseInt(ad/2)+Z.left-ac.left;var aa=V.top+V.height+Z.top-ac.top;K(X,P,ab,aa)};X=e(L.openPopup());if(X.hasClass("wysiwyg-popup")&&!X.hasClass("wysiwyg-popuphover")||X.data("special")!=(!!R)){X=e(L.closePopup().openPopup())}if(!X.hasClass("wysiwyg-popup")){X.addClass("wysiwyg-popup wysiwyg-popuphover");if(R){X.empty().append(R).data("special",true)}else{B(X,true,function(){return X.empty()
},W)}}W()},hijackcontextmenu:(k=="selection")};if(O){var M=e("<div/>").addClass("wysiwyg-placeholder").html(O).hide();P.prepend(M);N.onplaceholder=function(R){if(R){M.show()}else{M.hide()}}}var L=wysiwyg(N);return L};var w=e("<div/>").addClass("wysiwyg-container");if(E){w.addClass(E)}C.wrap(w);w=C.parent(".wysiwyg-container");var x=false;if(m){x=e("<div/>").addClass("wysiwyg-wrapper").click(function(){g.getElement().focus()});C.wrap(x);x=C.parent(".wysiwyg-wrapper")}var g=u(C,m?x:w,m);if(g.legacy){var C=e(g.getElement());C.addClass("wysiwyg-textarea");if(C.is(":visible")){C.width(w.width()-(C.outerWidth()-C.width()))}}else{e(g.getElement()).addClass("wysiwyg-editor")}var l={};e.each(D,function(L,N){if(!N||!N.hotkey){return}var M=v(L);if(!M){return}q[N.hotkey.toLowerCase()]=M;l[L]=M});if(k!="selection"){var p=k=="top"||k=="top-selection";var J=e("<div/>").addClass("wysiwyg-toolbar").addClass(p?"wysiwyg-toolbar-top":"wysiwyg-toolbar-bottom");B(J,false,function(){var L=e(g.openPopup());if(L.hasClass("wysiwyg-popup")&&L.hasClass("wysiwyg-popuphover")){L=e(g.closePopup().openPopup())}if(!L.hasClass("wysiwyg-popup")){L.addClass("wysiwyg-popup")}return L},function(Q,P,L){var M=e(P);var R=Q.outerWidth();var O=M.offset().left-w.offset().left+parseInt(M.width()/2)-parseInt(R/2);var N=M.offset().top-w.offset().top;if(p){N+=M.outerHeight()}else{N-=Q.outerHeight()}if(L){O=L.left;N=L.top}K(Q,w,O,N)});if(p){w.prepend(J)}else{w.append(J)}}return{wysiwygeditor:g,$container:w}};e.fn.wysiwyg=function(g,i){if(!g||typeof(g)==="object"){g=e.extend({},g);return this.each(function(){var p=e(this);if(p.data("wysiwyg")){return}var m=g.classes,v=g.placeholder||p.attr("placeholder"),k=(g.toolbar&&(g.toolbar=="top"||g.toolbar=="top-selection"||g.toolbar=="bottom"||g.toolbar=="bottom-selection"||g.toolbar=="selection"))?g.toolbar:"top-selection",n=g.buttons,u=g.submit,w=g.selectImage,x=g.placeholderUrl||null,t=g.placeholderEmbed||null,j=g.maxImageSize||null,r=g.onImageUpload||null,l=g.forceImageUpload&&r,s=g.videoFromUrl||null,q=g.onKeyPress;var o=b(p,m,v,k,n,u,w,x,t,j,r,l,s,q);p.data("wysiwyg",o)})}else{if(this.length==1){var h=this.data("wysiwyg");if(!h){return this}if(g=="container"){return h.$container}if(g=="shell"){return h.wysiwygeditor}}}return this}})(window,document,jQuery);