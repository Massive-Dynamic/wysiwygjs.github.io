(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],function(b){return a(window,document,navigator,b)})}else{if(typeof exports!=="undefined"){module.exports=a(window,document,navigator,require("jquery"))}else{return a(window,document,navigator,jQuery)}}}(function(k,s,a,d,e){var c=function(C,B,z){var A;return function(){if(A){if(!z){return}clearTimeout(A)}var E=this,D=arguments;A=setTimeout(function(){A=null;C.apply(E,D)},B)}};var t=function(A,C,B,z){if(A.addEventListener){A.addEventListener(C,B,z?true:false)}else{if(A.attachEvent){A.attachEvent("on"+C,B)}else{if(A!=k){A["on"+C]=B}}}};var v=function(A,C,B,z){if(A.removeEventListener){A.removeEventListener(C,B,z?true:false)}else{if(A.detachEvent){A.detachEvent("on"+C,B)}else{if(A!=k){A["on"+C]=null}}}};var y=function(B,C,A,z){if(s.createEvent){var D=s.createEvent("Event");D.initEvent(C,A!==e?A:true,z!==e?z:false);B.dispatchEvent(D)}else{if(s.createEventObject){var D=s.createEventObject();B.fireEvent("on"+C,D)}else{if(typeof(B["on"+C])=="function"){B["on"+C]()}}}};var w=function(z){if(z.preventDefault){z.preventDefault()}else{z.returnValue=false}if(z.stopPropagation){z.stopPropagation()}else{z.cancelBubble=true}return false};var p=typeof(Node)!="undefined"?Node.ELEMENT_NODE:1;var h=typeof(Node)!="undefined"?Node.TEXT_NODE:3;var n=function(z,A){var B=A;while(B){if(B===z){return true}B=B.parentNode}return false};var b=function(A,z){if(A.firstChild){return A.firstChild}while(A){if(A==z){return null}if(A.nextSibling){return A.nextSibling}A=A.parentNode}return null};var r=function(z){if(k.getSelection){var A=k.getSelection();if(A.rangeCount>0){return A.getRangeAt(0)}}else{if(s.selection){var A=s.selection;return A.createRange()}}return null};var m=function(z,B){if(!B){return}if(k.getSelection){var A=k.getSelection();A.removeAllRanges();A.addRange(B)}else{if(s.selection){B.select()}}};var j=function(){if(k.getSelection){var B=k.getSelection();if(!B.rangeCount){return false}var z=B.getRangeAt(0).cloneRange();if(z.getBoundingClientRect){var A=z.getBoundingClientRect();if(!A||(A.left==0&&A.top==0&&A.right==0&&A.bottom==0)){return false}return{left:parseInt(A.left),top:parseInt(A.top),width:parseInt(A.right-A.left),height:parseInt(A.bottom-A.top)}}}else{if(s.selection){var B=s.selection;if(B.type!="Control"){var z=B.createRange();return{left:z.boundingLeft,top:z.boundingTop,width:z.boundingWidth,height:z.boundingHeight}}}}return false};var i=function(A){if(k.getSelection){var C=k.getSelection();if(C.isCollapsed){return true}return false}else{if(s.selection){var C=s.selection;if(C.type=="Text"){var B=s.selection.createRange();var z=s.body.createTextRange();z.moveToElementText(A);z.setEndPoint("EndToStart",B);return B.htmlText.length==0}if(C.type=="Control"){return false}}}return true};var l=function(D){if(k.getSelection){var B=k.getSelection();if(!B.rangeCount){return[]}var A=[];for(var H=0;H<B.rangeCount;++H){var J=B.getRangeAt(H),C=J.startContainer,K=J.endContainer;while(C){if(C!=D){var L=false;if(B.containsNode){L=B.containsNode(C,true)}else{var G=s.createRange();G.selectNodeContents(C);for(var H=0;H<B.rangeCount;++H){var J=B.getRangeAt(H);if(J.compareBoundaryPoints(J.END_TO_START,G)>=0&&J.compareBoundaryPoints(J.START_TO_END,G)<=0){L=true;break}}}if(L){A.push(C)}}C=b(C,C==K?K:D)}}if(A.length==0&&n(D,B.focusNode)&&B.focusNode!=D){A.push(B.focusNode)}return A}else{if(s.selection){var B=s.selection;if(B.type=="Text"){var A=[];var z=B.createRangeCollection();for(var H=0;H<z.length;++H){var J=z[H],I=J.parentElement(),C=I;while(C){var G=J.duplicate();G.moveToElementText(C.nodeType!=p?C.parentNode:C);if(G.compareEndPoints("EndToStart",J)>=0&&G.compareEndPoints("StartToEnd",J)<=0){var F=false;for(var E=0;E<A.length;++E){if(A[E]!==C){continue}F=true;break}if(!F){A.push(C)}}C=b(C,I)}}if(A.length==0&&n(D,s.activeElement)&&s.activeElement!=D){A.push(s.activeElement)}return A}if(B.type=="Control"){var A=[];var J=B.createRange();for(var H=0;H<J.length;++H){A.push(J(H))}return A}}}return[]};var g=function(){if(k.getSelection){var A=k.getSelection();if(!A.isCollapsed){A.collapseToEnd()
}}else{if(s.selection){var A=s.selection;if(A.type!="Control"){var z=A.createRange();z.collapse(false);z.select()}}}};var u=function(A){if(i(A)){return null}if(k.getSelection){var F=k.getSelection();if(F.rangeCount){var B=s.createElement("div"),z=F.rangeCount;for(var D=0;D<z;++D){var E=F.getRangeAt(D).cloneContents();B.appendChild(E)}return B.innerHTML}}else{if(s.selection){var F=s.selection;if(F.type=="Text"){var C=F.createRange();return C.htmlText}}}return null};var o=function(z,D){if(k.getSelection){var C=k.getSelection();if(n(z,C.anchorNode)&&n(z,C.focusNode)){return true}if(!D){return false}var A=s.createRange();A.selectNodeContents(z);A.collapse(false);C.removeAllRanges();C.addRange(A)}else{if(s.selection){var C=s.selection;if(C.type=="Control"){var A=C.createRange();if(A.length!=0&&n(z,A(0))){return true}}else{var B=s.body.createTextRange();B.moveToElementText(z);var A=C.createRange();if(B.inRange(A)){return true}}if(!D){return false}var A=s.body.createTextRange();A.moveToElementText(z);A.setEndPoint("StartToEnd",A);A.select()}}return true};var x=function(D,F){if(k.getSelection){var A=k.getSelection();if(A.getRangeAt&&A.rangeCount){var G=A.getRangeAt(0);var B=s.createElement("div");B.innerHTML=F;var H=s.createDocumentFragment(),C,z;while((C=B.firstChild)){z=H.appendChild(C)}if(n(D,G.commonAncestorContainer)){G.deleteContents();G.insertNode(H)}else{D.appendChild(H)}if(z){G=G.cloneRange();G.setStartAfter(z);G.collapse(true);A.removeAllRanges();A.addRange(G)}}}else{if(s.selection){var A=s.selection;if(A.type!="Control"){var E=A.createRange();E.collapse(true);var G=A.createRange();if(n(D,G.parentElement())){G.pasteHTML(F)}else{var I=s.body.createTextRange();I.moveToElementText(D);I.collapse(false);I.select();I.pasteHTML(F)}G=A.createRange();G.setEndPoint("StartToEnd",E);G.select()}}}};k.wysiwyg=function(O){O=O||{};var A=O.element||null;var ah=O.onkeypress||null;var ag=O.onselection||null;var B=O.onplaceholder||null;var D=O.hijackcontextmenu||false;var N=A.nodeName=="TEXTAREA"||A.nodeName=="INPUT";if(N){var V="contentEditable" in s.body;if(V){var z=a.userAgent.match(/(?:iPad|iPhone|Android).* AppleWebKit\/([^ ]+)/);if(z&&420<=parseInt(z[1])&&parseInt(z[1])<534){V=false}}if(!V){var ac=A;var H=function(ai){return ai.replace(/<br[ \/]*>\n?/gi,"<br>\n")};ac.value=H(ac.value);var F=function(){return this};var S=function(){return null};return{legacy:true,getElement:function(){return ac},getHTML:function(){return ac.value},setHTML:function(ai){ac.value=H(ai);return this},getSelectedHTML:S,sync:F,collapseSelection:F,openPopup:S,closePopup:F,removeFormat:F,bold:F,italic:F,underline:F,strikethrough:F,forecolor:F,highlight:F,fontName:F,fontSize:F,subscript:F,superscript:F,align:F,format:F,indent:F,insertLink:F,insertImage:F,insertHTML:F,insertList:F}}}var ac=null,W=null;if(N){ac=A;ac.style.display="none";W=s.createElement("DIV");W.innerHTML=ac.value;var K=ac.parentNode,R=ac.nextSibling;if(R){K.insertBefore(W,R)}else{K.appendChild(W)}}else{W=A}W.setAttribute("contentEditable","true");var E=(s.all&&!s.addEventListener)?s:k;var P=null;if(N){var X=W.innerHTML;P=function(){var ai=W.innerHTML;if(ai==X){return}ac.value=ai;X=ai;y(ac,"change",false)}}var ae;if(B){var J=false;ae=function(){var ak=true;var ai=W;while(ai){ai=b(ai,W);if(!ai){}else{if(ai.nodeType==p){if(ai.nodeName=="IMG"){ak=false;break}}else{if(ai.nodeType==h){var aj=ai.nodeValue;if(aj&&aj.search(/[^\s]/)!=-1){ak=false;break}}}}}if(J!=ak){B(ak);J=ak}};ae()}var ab=null,U=null,C=null;if(ag){U=function(al,aj,au){var aq=i(W);var ak=l(W);var at=(al===null||aj===null)?null:{left:al,top:aj,width:0,height:0};var ai=j();if(ai){at=ai}if(at){if(W.getBoundingClientRect){var av=W.getBoundingClientRect();at.left-=parseInt(av.left);at.top-=parseInt(av.top)}else{var ao=W,an=0,am=0,ap=false;do{an+=ao.offsetLeft?parseInt(ao.offsetLeft):0;am+=ao.offsetTop?parseInt(ao.offsetTop):0;if(ao.style.position=="fixed"){ap=true}}while(ao=ao.offsetParent);at.left-=an-(ap?0:k.pageXOffset);at.top-=am-(ap?0:k.pageYOffset)}if(at.left<0){at.left=0}if(at.top<0){at.top=0}if(at.width>W.offsetWidth){at.width=W.offsetWidth
}if(at.height>W.offsetHeight){at.height=W.offsetHeight}}else{if(ak.length){for(var ar=0;ar<ak.length;++ar){var ao=ak[ar];if(ao.nodeType!=p){continue}at={left:ao.offsetLeft,top:ao.offsetTop,width:ao.offsetWidth,height:ao.offsetHeight};break}}}ag(aq,at,ak,au)};C=c(U,1)}var L=null;var af=function(aj){if(!aj){var aj=k.event}var ai=aj.target||aj.srcElement;if(ai.nodeType==h){ai=ai.parentNode}if(n(L,ai)){return}Q()};var aa=function(){if(L){return L}t(E,"mousedown",af,true);L=s.createElement("DIV");var aj=W.parentNode,ai=W.nextSibling;if(ai){aj.insertBefore(L,ai)}else{aj.appendChild(L)}return L};var Q=function(){if(!L){return}L.parentNode.removeChild(L);L=null;v(E,"mousedown",af,true)};t(W,"focus",function(){if(ac){y(ac,"focus",false)}});t(W,"blur",function(){if(P){P()}if(ac){y(ac,"blur",false)}});var M=null;if(ae||P){var G=P?c(P,250,true):null;var Z=function(ai){if(ae){ae()}if(G){G()}};M=c(Z,1);t(W,"input",M);t(W,"DOMNodeInserted",M);t(W,"DOMNodeRemoved",M);t(W,"DOMSubtreeModified",M);t(W,"DOMCharacterDataModified",M);t(W,"propertychange",M);t(W,"textInput",M);t(W,"paste",M);t(W,"cut",M);t(W,"drop",M)}var ad=function(al,ai){if(!al){var al=k.event}var aj=0;if(al.keyCode){aj=al.keyCode}else{if(al.which){aj=al.which}}var ak=al.charCode;if(ai==1&&ah){var am=ah(aj,ak?String(String):String.fromCharCode(aj),al.shiftKey||false,al.altKey||false,al.ctrlKey||false,al.metaKey||false);if(am===false){return w(al)}}if(ai==2||ai==3){ab=null;if(C){C(null,null,false)}}if(ai==2&&M){switch(aj){case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:break;default:M();break}}};t(W,"keydown",function(ai){return ad(ai,1)});t(W,"keypress",function(ai){return ad(ai,2)});t(W,"keyup",function(ai){return ad(ai,3)});var I=function(al,ai){if(!al){var al=k.event}var ak=null,aj=null;if(al.clientX&&al.clientY){ak=al.clientX;aj=al.clientY}else{if(al.pageX&&al.pageY){ak=al.pageX-k.pageXOffset;aj=al.pageY-k.pageYOffset}}if(al.which&&al.which==3){ai=true}else{if(al.button&&al.button==2){ai=true}}v(E,"mouseup",I);ab=null;if(!D&&ai){return}if(C){C(ak,aj,ai)}};t(W,"mousedown",function(ai){v(E,"mouseup",I);t(E,"mouseup",I)});t(W,"mouseup",function(ai){I(ai);if(M){M()}});t(W,"dblclick",function(ai){I(ai)});t(W,"selectionchange",function(ai){I(ai)});if(D){t(W,"contextmenu",function(ai){I(ai,true);return w(ai)})}var Y=function(an,am,ak){m(W,ab);if(!o(W,ak)){return false}if(k.getSelection){try{if(s.queryCommandSupported&&!s.queryCommandSupported(an)){return false}return s.execCommand(an,false,am)}catch(al){}}else{if(s.selection){var aj=s.selection;if(aj.type!="None"){var ai=aj.createRange();try{if(!ai.queryCommandEnabled(an)){return false}return ai.execCommand(an,false,am)}catch(al){}}}}return false};var T=function(ai){if(M){M()}if(ai){g();ab=null}else{if(ab){ab=r(W)}}};return{getElement:function(){return W},getHTML:function(){return W.innerHTML},setHTML:function(ai){W.innerHTML=ai;T(true);return this},getSelectedHTML:function(){m(W,ab);if(!o(W)){return null}return u(W)},sync:function(){if(P){P()}return this},collapseSelection:function(){g();ab=null;return this},openPopup:function(){if(!ab){ab=r(W)}return aa()},closePopup:function(){Q();return this},removeFormat:function(){Y("removeFormat");Y("unlink");T();return this},bold:function(){Y("bold");T();return this},italic:function(){Y("italic");T();return this},underline:function(){Y("underline");T();return this},strikethrough:function(){Y("strikeThrough");T();return this},forecolor:function(ai){Y("foreColor",ai);T();return this},highlight:function(ai){if(!Y("hiliteColor",ai)){Y("backColor",ai)}T();return this},fontName:function(ai){Y("fontName",ai);T();return this},fontSize:function(ai){Y("fontSize",ai);T();return this},subscript:function(){Y("subscript");T();return this},superscript:function(){Y("superscript");T();return this},align:function(ai){if(ai=="left"){Y("justifyLeft")}else{if(ai=="center"){Y("justifyCenter")}else{if(ai=="right"){Y("justifyRight")}else{if(ai=="justify"){Y("justifyFull")}}}}T();return this},format:function(ai){Y("formatBlock",ai);T();return this},indent:function(ai){Y(ai?"outdent":"indent");T();
return this},insertLink:function(ai){Y("createLink",ai);T(true);return this},insertImage:function(ai){Y("insertImage",ai,true);T(true);return this},insertHTML:function(ai){if(!Y("insertHTML",ai,true)){m(W,ab);o(W,true);x(W,ai)}T(true);return this},insertList:function(ai){Y(ai?"insertOrderedList":"insertUnorderedList");T();return this}}};var f=function(E,M,K){var z,F,I,D,H,B,A,L;D=Math.floor(E*6);H=E*6-D;B=K*(1-M);A=K*(1-H*M);L=K*(1-(1-H)*M);switch(D%6){case 0:z=K,F=L,I=B;break;case 1:z=A,F=K,I=B;break;case 2:z=B,F=K,I=L;break;case 3:z=B,F=A,I=K;break;case 4:z=L,F=B,I=K;break;case 5:z=K,F=B,I=A;break}var J=Math.floor(z*255).toString(16);var C=Math.floor(F*255).toString(16);var G=Math.floor(I*255).toString(16);return"#"+(J.length<2?"0":"")+J+(C.length<2?"0":"")+C+(G.length<2?"0":"")+G};var q=function(V,X,F,D,W,C,M,ab,A,K,G,B,H,Z){var T=function(ae,af){if(!af){}else{if(ae.getSelectedHTML()){ae.insertLink(af)}else{ae.insertHTML('<a href="'+af.replace(/"/,"&quot;")+'">'+af+"</a>")}}ae.closePopup().collapseSelection()};var Y=function(ae,ai){var ah=S(C);var aj=d('<input type="text" value="'+(ai?ai.attr("href"):"")+'" />').addClass("wysiwyg-input").keypress(function(ak){if(ak.which!=10&&ak.which!=13){return}if(ai){ai.attr("href",aj.val());ae.closePopup().collapseSelection()}else{try{T(ae,aj.val())}catch(al){ae.closePopup()}}});if(ab){aj.attr("placeholder",ab)}var ag=ah.click(function(ak){if(ai){ai.attr("href",aj.val());ae.closePopup().collapseSelection()}else{T(ae,aj.val())}ak.stopPropagation();ak.preventDefault();return false});var af=d("<div/>").addClass("wysiwyg-toolbar-form").attr("unselectable","on");af.append(aj).append(ag);return af};var R=function(ai){var ag=function(ap,ao){var aq='<img id="wysiwyg-insert-image" src="" alt=""'+(ao?' title="'+ao.replace(/"/,"&quot;")+'"':"")+" />";ai.insertHTML(aq).closePopup().collapseSelection();var ar=d("#wysiwyg-insert-image").removeAttr("id");if(K){ar.css({maxWidth:K[0]+"px",maxHeight:K[1]+"px"}).load(function(){ar.css({maxWidth:"",maxHeight:""});var au=ar.width(),at=ar.height();if(au>K[0]||at>K[1]){if((au/at)>(K[0]/K[1])){at=parseInt(at/au*K[0]);au=K[0]}else{au=parseInt(au/at*K[1]);at=K[1]}ar.attr("width",au).attr("height",at)}})}ar.attr("src",ap)};var ah=d("<div/>").addClass("wysiwyg-toolbar-form").attr("unselectable","on");var al=null,an=d('<input type="file" />').css({position:"absolute",left:0,top:0,width:"100%",height:"100%",opacity:0,cursor:"pointer"});if(!B&&k.File&&k.FileReader&&k.FileList){var aj=function(ap){if(!ap.type.match("image.*")){return}var ao=new FileReader();ao.onload=function(ar){var aq=ar.target.result;ag(aq,ap.name)};ao.readAsDataURL(ap)};al=an.attr("draggable","true").change(function(aq){var ap=aq.target.files;for(var ao=0;ao<ap.length;++ao){aj(ap[ao])}}).on("dragover",function(ao){ao.originalEvent.dataTransfer.dropEffect="copy";ao.stopPropagation();ao.preventDefault();return false}).on("drop",function(aq){var ap=aq.originalEvent.dataTransfer.files;for(var ao=0;ao<ap.length;++ao){aj(ap[ao])}aq.stopPropagation();aq.preventDefault();return false})}else{if(G){var am=an.change(function(ao){G.call(this,ag)});al=d("<form/>").append(am)}}if(al){d("<div/>").addClass("wysiwyg-browse").html(M).append(al).appendTo(ah)}var ae=S(C);var ak=d('<input type="text" value="" />').addClass("wysiwyg-input").keypress(function(ao){if(ao.which==10||ao.which==13){ag(ak.val())}});if(ab){ak.attr("placeholder",ab)}var af=ae.click(function(ao){ag(ak.val());ao.stopPropagation();ao.preventDefault();return false});ah.append(d("<div/>").append(ak).append(af));return ah};var aa=function(ae){var ah=function(al,am){al=d.trim(al||"");am=d.trim(am||"");var an=false;if(al.length&&!am.length){an=al}else{if(am.indexOf("<")==-1&&am.indexOf(">")==-1&&am.match(/^(?:https?:\/)?\/?(?:[^:\/\s]+)(?:(?:\/\w+)*\/)(?:[\w\-\.]+[^#?\s]+)(?:.*)?(?:#[\w\-]+)?$/)){an=am}}if(an&&H){am=H(an)||""}if(!am.length&&an){am='<video src="'+an.replace(/"/,"&quot;")+'" />'}ae.insertHTML(am).closePopup().collapseSelection()};var af=d("<div/>").addClass("wysiwyg-toolbar-form").attr("unselectable","on");var ag=d("<textarea>").addClass("wysiwyg-input wysiwyg-inputtextarea");
if(A){ag.attr("placeholder",A)}d("<div/>").addClass("wysiwyg-embedcode").append(ag).appendTo(af);var aj=S(C);var ak=d('<input type="text" value="" />').addClass("wysiwyg-input").keypress(function(al){if(al.which==10||al.which==13){ah(ak.val())}});if(ab){ak.attr("placeholder",ab)}var ai=aj.click(function(al){ah(ak.val(),ag.val());al.stopPropagation();al.preventDefault();return false});af.append(d("<div/>").append(ak).append(ai));return af};var L=function(af,ah){var ae=d("<table/>").attr("cellpadding","0").attr("cellspacing","0").attr("unselectable","on");for(var ap=1;ap<15;++ap){var an=d("<tr/>");for(var ag=0;ag<25;++ag){var ai;if(ag==24){var ao=Math.floor(255/13*(14-ap)).toString(16);var al=(ao.length<2?"0":"")+ao;ai="#"+al+al+al}else{var ak=ag/24;var aj=ap<=8?ap/8:1;var am=ap>8?(16-ap)/8:1;ai=f(ak,aj,am)}d("<td/>").addClass("wysiwyg-toolbar-color").attr("title",ai).attr("unselectable","on").css({backgroundColor:ai}).click(function(){var aq=this.title;if(ah){af.forecolor(aq).closePopup().collapseSelection()}else{af.highlight(aq).closePopup().collapseSelection()}return false}).appendTo(an)}ae.append(an)}return ae};var O=function(ae,af){switch(ae){case"insertimage":if(!af){return null}return function(ag){af(R(z),ag)};case"insertvideo":if(!af){return null}return function(ag){af(aa(z),ag)};case"insertlink":if(!af){return null}return function(ag){af(Y(z),ag)};case"bold":return function(){z.bold()};case"italic":return function(){z.italic()};case"underline":return function(){z.underline()};case"strikethrough":return function(){z.strikethrough()};case"forecolor":if(!af){return null}return function(ag){af(L(z,true),ag)};case"highlight":if(!af){return null}return function(ag){af(L(z,false),ag)};case"alignleft":return function(){z.align("left")};case"aligncenter":return function(){z.align("center")};case"alignright":return function(){z.align("right")};case"alignjustify":return function(){z.align("justify")};case"subscript":return function(){z.subscript()};case"superscript":return function(){z.superscript()};case"indent":return function(){z.indent()};case"outdent":return function(){z.indent(true)};case"orderedList":return function(){z.insertList(true)};case"unorderedList":return function(){z.insertList()};case"removeformat":return function(){z.removeFormat().closePopup().collapseSelection()}}return null};var S=function(ae){return d("<a/>").addClass("wysiwyg-toolbar-icon").attr("href","#").attr("title",ae.title).attr("unselectable","on").append(ae.image)};var U=function(ae,af,ag,ah){d.each(W,function(ai,al){if(!al){return}if(af===false&&"showstatic" in al&&!al.showstatic){return}if(af===true&&"showselection" in al&&!al.showselection){return}var ak;if("click" in al){ak=function(am){al.click(d(am))}}else{if("popup" in al){ak=function(an){var ao=ag();var am=al.popup(ao,d(an));ah(ao,an,am)}}else{ak=O(ai,function(am,an){var ao=ag();ao.append(am);ah(ao,an);ao.find("input[type=text]:first").focus()})}}var aj;if(ak){aj=S(al).click(function(am){ak(am.currentTarget);if(O(ai)){z.getElement().focus()}am.stopPropagation();am.preventDefault();return false})}else{if(al.html){aj=d(al.html)}}if(aj){ae.append(aj)}})};var ad=function(ae,at,ai,ap){var ar=at.get(0).offsetParent,ak={left:0,top:0},an=false,af=false,aq=ae.width(),ah=ar;while(ah){ak.left+=ah.offsetLeft;ak.top+=ah.offsetTop;var ag=d(ah);if(ag.css("position")=="fixed"){an=true}if(ag.css("overflow")!="visible"){af=true}ah=ah.offsetParent}var ao=d(ar||s.body);ao.append(ae);var aj=at.position();ai+=aj.left;ap+=aj.top;if(an||af){if(ai+aq>ao.width()-1){ai=ao.width()-aq-1}if(ai<1){ai=1}}var am=d(k).width();if(ak.left+ai+aq>am-1){ai=am-ak.left-aq-1}var al=an?0:d(k).scrollLeft();if(ak.left+ai<al+1){ai=al-ak.left+1}ae.css({left:parseInt(ai)+"px",top:parseInt(ap)+"px"})};var J={};var N=function(aj,ai,ah){var ag={element:aj.get(0),onkeypress:function(am,ao,al,an,aq,ap){if(Z&&Z(am,ao,al,an,aq,ap)===false){return false}if(ao&&!al&&!an&&aq&&!ap){var ak=ao.toLowerCase();if(!J[ak]){return}J[ak]();return false}},onselection:function(ar,ao,al,am){var an=true,ak=null;if(ar){d.each(al,function(at,au){if(d(au).parents("a").length!=0){ak=Y(ae,d(au).parents("a:first"));
return false}})}if(!ao){an=false}else{if(ak){}else{if(am){}else{if(D!="selection"&&D!="top-selection"&&D!="bottom-selection"){an=false}else{if(ar){an=false}else{if(al.length==1&&al[0].nodeName=="IMG"){an=false}}}}}}if(!an){ae.closePopup();return}var aq;var ap=function(){var ax=aq.outerWidth();var aw=ai.offset(),at=d(ae.getElement()).offset();var av=ao.left+parseInt(ao.width/2)-parseInt(ax/2)+at.left-aw.left;var au=ao.top+ao.height+at.top-aw.top;ad(aq,ai,av,au)};aq=d(ae.openPopup());if(aq.hasClass("wysiwyg-popup")&&!aq.hasClass("wysiwyg-popuphover")||aq.data("special")!=(!!ak)){aq=d(ae.closePopup().openPopup())}if(!aq.hasClass("wysiwyg-popup")){aq.addClass("wysiwyg-popup wysiwyg-popuphover");if(ak){aq.empty().append(ak).data("special",true)}else{U(aq,true,function(){return aq.empty()},ap)}}ap()},hijackcontextmenu:(D=="selection")};if(ah){var af=d("<div/>").addClass("wysiwyg-placeholder").html(ah).hide();ai.prepend(af);ag.onplaceholder=function(ak){if(ak){af.show()}else{af.hide()}}}var ae=wysiwyg(ag);return ae};var P=d("<div/>").addClass("wysiwyg-container");if(X){P.addClass(X)}V.wrap(P);P=V.parent(".wysiwyg-container");var Q=false;if(F){Q=d("<div/>").addClass("wysiwyg-wrapper").click(function(){z.getElement().focus()});V.wrap(Q);Q=V.parent(".wysiwyg-wrapper")}var z=N(V,F?Q:P,F);if(z.legacy){var V=d(z.getElement());V.addClass("wysiwyg-textarea");if(V.is(":visible")){V.width(P.width()-(V.outerWidth()-V.width()))}}else{d(z.getElement()).addClass("wysiwyg-editor")}var E={};d.each(W,function(ae,ag){if(!ag||!ag.hotkey){return}var af=O(ae);if(!af){return}J[ag.hotkey.toLowerCase()]=af;E[ae]=af});if(D!="selection"){var I=D=="top"||D=="top-selection";var ac=d("<div/>").addClass("wysiwyg-toolbar").addClass(I?"wysiwyg-toolbar-top":"wysiwyg-toolbar-bottom");U(ac,false,function(){var ae=d(z.openPopup());if(ae.hasClass("wysiwyg-popup")&&ae.hasClass("wysiwyg-popuphover")){ae=d(z.closePopup().openPopup())}if(!ae.hasClass("wysiwyg-popup")){ae.addClass("wysiwyg-popup")}return ae},function(aj,ai,ae){var af=d(ai);var ak=aj.outerWidth();var ah=af.offset().left-P.offset().left+parseInt(af.width()/2)-parseInt(ak/2);var ag=af.offset().top-P.offset().top;if(I){ag+=af.outerHeight()}else{ag-=aj.outerHeight()}if(ae){ah=ae.left;ag=ae.top}ad(aj,P,ah,ag)});if(I){P.prepend(ac)}else{P.append(ac)}}return{wysiwygeditor:z,$container:P}};d.fn.wysiwyg=function(z,B){if(!z||typeof(z)==="object"){z=d.extend({},z);return this.each(function(){var I=d(this);if(I.data("wysiwyg")){return}var F=z.classes,O=z.placeholder||I.attr("placeholder"),D=(z.toolbar&&(z.toolbar=="top"||z.toolbar=="top-selection"||z.toolbar=="bottom"||z.toolbar=="bottom-selection"||z.toolbar=="selection"))?z.toolbar:"top-selection",G=z.buttons,N=z.submit,P=z.selectImage,Q=z.placeholderUrl||null,M=z.placeholderEmbed||null,C=z.maxImageSize||null,K=z.onImageUpload||null,E=z.forceImageUpload&&K,L=z.videoFromUrl||null,J=z.onKeyPress;var H=q(I,F,O,D,G,N,P,Q,M,C,K,E,L,J);I.data("wysiwyg",H)})}else{if(this.length==1){var A=this.data("wysiwyg");if(!A){return this}if(z=="container"){return A.$container}if(z=="shell"){return A.wysiwygeditor}}}return this}}));