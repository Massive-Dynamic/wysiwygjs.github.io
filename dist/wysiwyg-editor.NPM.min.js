(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],function(b){return a(window,document,navigator,b)})}else{if(typeof exports!=="undefined"){module.exports=a(window,document,navigator,require("jquery"))}else{return a(window,document,navigator,jQuery)}}}(function(m,u,a,f,g){var d=function(F,E,C){var D;return function(){if(D){if(!C){return}clearTimeout(D)}var H=this,G=arguments;D=setTimeout(function(){D=null;F.apply(H,G)},E)}};var v=function(D,F,E,C){if(D.addEventListener){D.addEventListener(F,E,C?true:false)}else{if(D.attachEvent){D.attachEvent("on"+F,E)}else{if(D!=m){D["on"+F]=E}}}};var x=function(D,F,E,C){if(D.removeEventListener){D.removeEventListener(F,E,C?true:false)}else{if(D.detachEvent){D.detachEvent("on"+F,E)}else{if(D!=m){D["on"+F]=null}}}};var B=function(E,F,D,C){if(u.createEvent){var G=u.createEvent("Event");G.initEvent(F,D!==g?D:true,C!==g?C:false);E.dispatchEvent(G)}else{if(u.createEventObject){var G=u.createEventObject();E.fireEvent("on"+F,G)}else{if(typeof(E["on"+F])=="function"){E["on"+F]()}}}};var y=function(C){if(C.preventDefault){C.preventDefault()}else{C.returnValue=false}if(C.stopPropagation){C.stopPropagation()}else{C.cancelBubble=true}return false};var r=typeof(Node)!="undefined"?Node.ELEMENT_NODE:1;var j=typeof(Node)!="undefined"?Node.TEXT_NODE:3;var p=function(C,D){var E=D;while(E){if(E===C){return true}E=E.parentNode}return false};var c=function(D,C){if(D.firstChild){return D.firstChild}while(D){if(D==C){return null}if(D.nextSibling){return D.nextSibling}D=D.parentNode}return null};var t=function(C){if(m.getSelection){var D=m.getSelection();if(D.rangeCount>0){return D.getRangeAt(0)}}else{if(u.selection){var D=u.selection;return D.createRange()}}return null};var o=function(C,E){if(!E){return}if(m.getSelection){var D=m.getSelection();D.removeAllRanges();D.addRange(E)}else{if(u.selection){E.select()}}};var l=function(){if(m.getSelection){var G=m.getSelection();if(!G.rangeCount){return false}var D=G.getRangeAt(0).cloneRange();if(D.getBoundingClientRect){var F=D.getBoundingClientRect();if(F&&F.left&&F.top&&F.right&&F.bottom){return{left:parseInt(F.left),top:parseInt(F.top),width:parseInt(F.right-F.left),height:parseInt(F.bottom-F.top)}}var C=D.getClientRects?D.getClientRects():[];for(var E=0;E<C.length;++E){var F=C[E];if(F.left&&F.top&&F.right&&F.bottom){return{left:parseInt(F.left),top:parseInt(F.top),width:parseInt(F.right-F.left),height:parseInt(F.bottom-F.top)}}}}}else{if(u.selection){var G=u.selection;if(G.type!="Control"){var D=G.createRange();if(D.boundingLeft||D.boundingTop||D.boundingWidth||D.boundingHeight){return{left:D.boundingLeft,top:D.boundingTop,width:D.boundingWidth,height:D.boundingHeight}}}}}return false};var k=function(D){if(m.getSelection){var F=m.getSelection();if(F.isCollapsed){return true}return false}else{if(u.selection){var F=u.selection;if(F.type=="Text"){var E=u.selection.createRange();var C=u.body.createTextRange();C.moveToElementText(D);C.setEndPoint("EndToStart",E);return E.htmlText.length==0}if(F.type=="Control"){return false}}}return true};var n=function(G){if(m.getSelection){var E=m.getSelection();if(!E.rangeCount){return[]}var D=[];for(var K=0;K<E.rangeCount;++K){var M=E.getRangeAt(K),F=M.startContainer,N=M.endContainer;while(F){if(F!=G){var O=false;if(E.containsNode){O=E.containsNode(F,true)}else{var J=u.createRange();J.selectNodeContents(F);for(var K=0;K<E.rangeCount;++K){var M=E.getRangeAt(K);if(M.compareBoundaryPoints(M.END_TO_START,J)>=0&&M.compareBoundaryPoints(M.START_TO_END,J)<=0){O=true;break}}}if(O){D.push(F)}}F=c(F,F==N?N:G)}}if(D.length==0&&p(G,E.focusNode)&&E.focusNode!=G){D.push(E.focusNode)}return D}else{if(u.selection){var E=u.selection;if(E.type=="Text"){var D=[];var C=E.createRangeCollection();for(var K=0;K<C.length;++K){var M=C[K],L=M.parentElement(),F=L;while(F){var J=M.duplicate();J.moveToElementText(F.nodeType!=r?F.parentNode:F);if(J.compareEndPoints("EndToStart",M)>=0&&J.compareEndPoints("StartToEnd",M)<=0){var I=false;for(var H=0;H<D.length;++H){if(D[H]!==F){continue}I=true;break}if(!I){D.push(F)}}F=c(F,L)}}if(D.length==0&&p(G,u.activeElement)&&u.activeElement!=G){D.push(u.activeElement)
}return D}if(E.type=="Control"){var D=[];var M=E.createRange();for(var K=0;K<M.length;++K){D.push(M(K))}return D}}}return[]};var i=function(){if(m.getSelection){var D=m.getSelection();if(!D.isCollapsed){try{D.collapseToEnd()}catch(E){}}}else{if(u.selection){var D=u.selection;if(D.type!="Control"){var C=D.createRange();C.collapse(false);C.select()}}}};var e=function(C,G,F){if(m.getSelection){var H=m.getSelection();if(H.modify){for(var E=0;E<G;++E){H.modify("extend","backward","character")}for(var E=0;E<F;++E){H.modify("extend","forward","character")}}else{var D=H.getRangeAt(0);D.setStart(D.startContainer,D.startOffset-G);D.setEnd(D.endContainer,D.endOffset+F);H.removeAllRanges();H.addRange(D)}}else{if(u.selection){var H=u.selection;if(H.type!="Control"){var D=H.createRange();D.collapse(true);D.moveStart("character",-G);D.moveEnd("character",F);D.select()}}}};var w=function(D){if(k(D)){return null}if(m.getSelection){var I=m.getSelection();if(I.rangeCount){var E=u.createElement("div"),C=I.rangeCount;for(var G=0;G<C;++G){var H=I.getRangeAt(G).cloneContents();E.appendChild(H)}return E.innerHTML}}else{if(u.selection){var I=u.selection;if(I.type=="Text"){var F=I.createRange();return F.htmlText}}}return null};var q=function(C,G){if(m.getSelection){var F=m.getSelection();if(p(C,F.anchorNode)&&p(C,F.focusNode)){return true}if(!G){return false}var D=u.createRange();D.selectNodeContents(C);D.collapse(false);F.removeAllRanges();F.addRange(D)}else{if(u.selection){var F=u.selection;if(F.type=="Control"){var D=F.createRange();if(D.length!=0&&p(C,D(0))){return true}}else{var E=u.body.createTextRange();E.moveToElementText(C);var D=F.createRange();if(E.inRange(D)){return true}}if(!G){return false}var D=u.body.createTextRange();D.moveToElementText(C);D.setEndPoint("StartToEnd",D);D.select()}}return true};var z=function(G,I){if(m.getSelection){var D=m.getSelection();if(D.getRangeAt&&D.rangeCount){var J=D.getRangeAt(0);var E=u.createElement("div");E.innerHTML=I;var K=u.createDocumentFragment(),F,C;while((F=E.firstChild)){C=K.appendChild(F)}if(p(G,J.commonAncestorContainer)){J.deleteContents();J.insertNode(K)}else{G.appendChild(K)}if(C){J=J.cloneRange();J.setStartAfter(C);J.collapse(true);D.removeAllRanges();D.addRange(J)}}}else{if(u.selection){var D=u.selection;if(D.type!="Control"){var H=D.createRange();H.collapse(true);var J=D.createRange();if(p(G,J.parentElement())){J.pasteHTML(I)}else{var L=u.body.createTextRange();L.moveToElementText(G);L.collapse(false);L.select();L.pasteHTML(I)}J=D.createRange();J.setEndPoint("StartToEnd",H);J.select()}}}};var b=function(ae){ae=ae||{};var Y=ae.element||null;if(typeof(Y)=="string"){Y=u.getElementById(Y)}var U=ae.onKeyDown||null;var al=ae.onKeyPress||null;var D=ae.onKeyUp||null;var W=ae.onSelection||null;var af=ae.onPlaceholder||null;var S=ae.onClosepopup||null;var ah=ae.hijackContextmenu||false;var V=Y.nodeName=="TEXTAREA"||Y.nodeName=="INPUT";if(V){var ad="contentEditable" in u.body;if(ad){var K=a.userAgent.match(/(?:iPad|iPhone|Android).* AppleWebKit\/([^ ]+)/);if(K&&420<=parseInt(K[1])&&parseInt(K[1])<534){ad=false}}if(!ad){var N=Y;var ai=function(aq){return aq.replace(/<br[ \/]*>\n?/gi,"<br>\n")};N.value=ai(N.value);var an=function(){return this};var F=function(){return null};return{legacy:true,getElement:function(){return N},getHTML:function(){return N.value},setHTML:function(aq){N.value=ai(aq);return this},getSelectedHTML:F,sync:an,collapseSelection:an,expandSelection:an,openPopup:F,closePopup:an,removeFormat:an,bold:an,italic:an,underline:an,strikethrough:an,forecolor:an,highlight:an,fontName:an,fontSize:an,subscript:an,superscript:an,align:an,format:an,indent:an,insertLink:an,insertImage:an,insertHTML:an,insertList:an}}}var N=null,ap=null;if(V){N=Y;N.style.display="none";ap=u.createElement("DIV");ap.innerHTML=N.value;var P=N.parentNode,E=N.nextSibling;if(E){P.insertBefore(ap,E)}else{P.appendChild(ap)}}else{ap=Y}ap.setAttribute("contentEditable","true");var T=(u.all&&!u.addEventListener)?u:m;var X=null;if(V){var M=ap.innerHTML;X=function(){var aq=ap.innerHTML;if(aq==M){return}N.value=aq;M=aq;B(N,"change",false)
}}var ac;if(af){var R=false;ac=function(){var at=true;var aq=ap;while(aq){aq=c(aq,ap);if(!aq){}else{if(aq.nodeType==r){if(aq.nodeName=="IMG"){at=false;break}}else{if(aq.nodeType==j){var ar=aq.nodeValue;if(ar&&ar.search(/[^\s]/)!=-1){at=false;break}}}}}if(R!=at){af(at);R=at}};ac()}var aa=null,J=null,Z=null;if(W){J=function(au,ar,aC){var az=k(ap);var at=n(ap);var aB=(au===null||ar===null)?null:{left:au,top:ar,width:0,height:0};var aq=l();if(aq){aB=aq}if(aB){if(ap.getBoundingClientRect){var aD=ap.getBoundingClientRect();aB.left-=parseInt(aD.left);aB.top-=parseInt(aD.top)}else{var ax=ap,aw=0,av=0,ay=false;do{aw+=ax.offsetLeft?parseInt(ax.offsetLeft):0;av+=ax.offsetTop?parseInt(ax.offsetTop):0;if(ax.style.position=="fixed"){ay=true}}while(ax=ax.offsetParent);aB.left-=aw-(ay?0:m.pageXOffset);aB.top-=av-(ay?0:m.pageYOffset)}if(aB.left<0){aB.left=0}if(aB.top<0){aB.top=0}if(aB.width>ap.offsetWidth){aB.width=ap.offsetWidth}if(aB.height>ap.offsetHeight){aB.height=ap.offsetHeight}}else{if(at.length){for(var aA=0;aA<at.length;++aA){var ax=at[aA];if(ax.nodeType!=r){continue}aB={left:ax.offsetLeft,top:ax.offsetTop,width:ax.offsetWidth,height:ax.offsetHeight};break}}}W(az,aB,at,aC)};Z=d(J,1)}var aj=null;var I=function(ar){if(!ar){var ar=m.event}var aq=ar.target||ar.srcElement;if(aq.nodeType==j){aq=aq.parentNode}if(p(aj,aq)){return}ao()};var ag=function(){if(aj){return aj}v(T,"mousedown",I,true);aj=u.createElement("DIV");var ar=ap.parentNode,aq=ap.nextSibling;if(aq){ar.insertBefore(aj,aq)}else{ar.appendChild(aj)}return aj};var ao=function(){if(!aj){return}aj.parentNode.removeChild(aj);aj=null;x(T,"mousedown",I,true);if(S){S()}};v(ap,"focus",function(){if(N){B(N,"focus",false)}});v(ap,"blur",function(){if(X){X()}if(N){B(N,"blur",false)}});var G=null;if(ac||X){var H=X?d(X,250,true):null;var am=function(aq){if(ac){ac()}if(H){H()}};G=d(am,1);v(ap,"input",G);v(ap,"DOMNodeInserted",G);v(ap,"DOMNodeRemoved",G);v(ap,"DOMSubtreeModified",G);v(ap,"DOMCharacterDataModified",G);v(ap,"propertychange",G);v(ap,"textInput",G);v(ap,"paste",G);v(ap,"cut",G);v(ap,"drop",G)}var O=function(aw,aq){if(!aw){var aw=m.event}var at=aw.which||aw.keyCode,av=String.fromCharCode(at||aw.charCode),ar=aw.shiftKey||false,au=aw.altKey||false,ay=aw.ctrlKey||false,ax=aw.metaKey||false;if(aq==1){if(U&&U(at,av,ar,au,ay,ax)===false){return y(aw)}}else{if(aq==2){if(al&&al(at,av,ar,au,ay,ax)===false){return y(aw)}}else{if(aq==3){if(D&&D(at,av,ar,au,ay,ax)===false){return y(aw)}}}}if(aq==2||aq==3){aa=null;if(Z){Z(null,null,false)}}if(aq==2&&G){switch(at){case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:break;default:G();break}}};v(ap,"keydown",function(aq){return O(aq,1)});v(ap,"keypress",function(aq){return O(aq,2)});v(ap,"keyup",function(aq){return O(aq,3)});var ak=function(au,aq){if(!au){var au=m.event}var at=null,ar=null;if(au.clientX&&au.clientY){at=au.clientX;ar=au.clientY}else{if(au.pageX&&au.pageY){at=au.pageX-m.pageXOffset;ar=au.pageY-m.pageYOffset}}if(au.which&&au.which==3){aq=true}else{if(au.button&&au.button==2){aq=true}}x(T,"mouseup",ak);aa=null;if(!ah&&aq){return}if(Z){Z(at,ar,aq)}};v(ap,"mousedown",function(aq){x(T,"mouseup",ak);v(T,"mouseup",ak)});v(ap,"mouseup",function(aq){ak(aq);if(G){G()}});v(ap,"dblclick",function(aq){ak(aq)});v(ap,"selectionchange",function(aq){ak(aq)});if(ah){v(ap,"contextmenu",function(aq){ak(aq,true);return y(aq)})}var C=function(aw,av,at){o(ap,aa);if(!q(ap,at)){return false}if(m.getSelection){try{if(u.queryCommandSupported&&!u.queryCommandSupported(aw)){return false}return u.execCommand(aw,false,av)}catch(au){}}else{if(u.selection){var ar=u.selection;if(ar.type!="None"){var aq=ar.createRange();try{if(!aq.queryCommandEnabled(aw)){return false}return aq.execCommand(aw,false,av)}catch(au){}}}}return false};var L=null;var Q=function(){if(u.all||!!m.MSInputMethodContext){L=u.createElement("DIV");ap.appendChild(L)}};var ab=function(aq){if(L){ap.removeChild(L);L=null}if(G){G()}if(aq){i();aa=null}else{if(aa){aa=t(ap)}}};return{getElement:function(){return ap},getHTML:function(){return ap.innerHTML},setHTML:function(aq){ap.innerHTML=aq;
ab(true);return this},getSelectedHTML:function(){o(ap,aa);if(!q(ap)){return null}return w(ap)},sync:function(){if(X){X()}return this},collapseSelection:function(){i();aa=null;return this},expandSelection:function(ar,aq){o(ap,aa);if(!q(ap)){return this}e(ap,ar,aq);aa=t(ap);return this},openPopup:function(){if(!aa){aa=t(ap)}return ag()},closePopup:function(){ao();return this},removeFormat:function(){C("removeFormat");C("unlink");ab();return this},bold:function(){C("bold");ab();return this},italic:function(){C("italic");ab();return this},underline:function(){C("underline");ab();return this},strikethrough:function(){C("strikeThrough");ab();return this},forecolor:function(aq){C("foreColor",aq);ab();return this},highlight:function(aq){if(!C("hiliteColor",aq)){C("backColor",aq)}ab();return this},fontName:function(aq){C("fontName",aq);ab();return this},fontSize:function(aq){C("fontSize",aq);ab();return this},subscript:function(){C("subscript");ab();return this},superscript:function(){C("superscript");ab();return this},align:function(aq){Q();if(aq=="left"){C("justifyLeft")}else{if(aq=="center"){C("justifyCenter")}else{if(aq=="right"){C("justifyRight")}else{if(aq=="justify"){C("justifyFull")}}}}ab();return this},format:function(aq){Q();C("formatBlock",aq);ab();return this},indent:function(aq){Q();C(aq?"outdent":"indent");ab();return this},insertLink:function(aq){C("createLink",aq);ab(true);return this},insertImage:function(aq){C("insertImage",aq,true);ab(true);return this},insertHTML:function(aq){if(!C("insertHTML",aq,true)){o(ap,aa);q(ap,true);z(ap,aq)}ab(true);return this},insertList:function(aq){Q();C(aq?"insertOrderedList":"insertUnorderedList");ab();return this}}};var h=function(H,P,N){var C,I,L,G,K,E,D,O;G=Math.floor(H*6);K=H*6-G;E=N*(1-P);D=N*(1-K*P);O=N*(1-(1-K)*P);switch(G%6){case 0:C=N,I=O,L=E;break;case 1:C=D,I=N,L=E;break;case 2:C=E,I=N,L=O;break;case 3:C=E,I=D,L=N;break;case 4:C=O,I=E,L=N;break;case 5:C=N,I=E,L=D;break}var M=Math.floor(C*255).toString(16);var F=Math.floor(I*255).toString(16);var J=Math.floor(L*255).toString(16);return"#"+(M.length<2?"0":"")+M+(F.length<2?"0":"")+F+(J.length<2?"0":"")+J};var A=function(C){return C.replace(/[&<>"]/g,function(D){var E={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};return E[D]||D})};var s=function(ab,ad,I,G,ac,F,R,ah,D,P,J,E,L,aa,af,K,O){var Y=function(al,am){if(!am){}else{if(al.getSelectedHTML()){al.insertLink(am)}else{al.insertHTML('<a href="'+A(am)+'">'+A(am)+"</a>")}}al.closePopup().collapseSelection()};var ae=function(al,ap){var ao=X(F);var aq=f('<input type="text" value="'+(ap?ap.attr("href"):"")+'" />').addClass("wysiwyg-input").keypress(function(ar){if(ar.which!=10&&ar.which!=13){return}if(ap){ap.attr("href",aq.val());al.closePopup().collapseSelection()}else{Y(al,aq.val())}});if(ah){aq.attr("placeholder",ah)}var an=ao.click(function(ar){if(ap){ap.attr("href",aq.val());al.closePopup().collapseSelection()}else{Y(al,aq.val())}ar.stopPropagation();ar.preventDefault();return false});var am=f("<div/>").addClass("wysiwyg-toolbar-form").attr("unselectable","on");am.append(aq).append(an);return am};var W=function(ap){var an=function(ax,aw){var ay='<img id="wysiwyg-insert-image" src="" alt=""'+(aw?' title="'+A(aw)+'"':"")+" />";ap.insertHTML(ay).closePopup().collapseSelection();var az=f("#wysiwyg-insert-image").removeAttr("id");if(P){az.css({maxWidth:P[0]+"px",maxHeight:P[1]+"px"}).load(function(){az.css({maxWidth:"",maxHeight:""});var aB=az.width(),aA=az.height();if(aB>P[0]||aA>P[1]){if((aB/aA)>(P[0]/P[1])){aA=parseInt(aA/aB*P[0]);aB=P[0]}else{aB=parseInt(aB/aA*P[1]);aA=P[1]}az.attr("width",aB).attr("height",aA)}})}az.attr("src",ax)};var ao=f("<div/>").addClass("wysiwyg-toolbar-form").attr("unselectable","on");var at=null,av=f('<input type="file" />').css({position:"absolute",left:0,top:0,width:"100%",height:"100%",opacity:0,cursor:"pointer"});if(!E&&m.File&&m.FileReader&&m.FileList){var aq=function(ax){if(!ax.type.match("image.*")){return}var aw=new FileReader();aw.onload=function(az){var ay=az.target.result;an(ay,ax.name)};aw.readAsDataURL(ax)};at=av.attr("draggable","true").change(function(ay){var ax=ay.target.files;
for(var aw=0;aw<ax.length;++aw){aq(ax[aw])}}).on("dragover",function(aw){aw.originalEvent.dataTransfer.dropEffect="copy";aw.stopPropagation();aw.preventDefault();return false}).on("drop",function(ay){var ax=ay.originalEvent.dataTransfer.files;for(var aw=0;aw<ax.length;++aw){aq(ax[aw])}ay.stopPropagation();ay.preventDefault();return false})}else{if(J){var au=av.change(function(aw){J.call(this,an)});at=f("<form/>").append(au)}}if(at){f("<div/>").addClass("wysiwyg-browse").html(R).append(at).appendTo(ao)}var al=X(F);var ar=f('<input type="text" value="" />').addClass("wysiwyg-input").keypress(function(aw){if(aw.which==10||aw.which==13){an(ar.val())}});if(ah){ar.attr("placeholder",ah)}var am=al.click(function(aw){an(ar.val());aw.stopPropagation();aw.preventDefault();return false});ao.append(f("<div/>").append(ar).append(am));return ao};var ag=function(al){var ao=function(at,au){at=f.trim(at||"");au=f.trim(au||"");var av=false;if(at.length&&!au.length){av=at}else{if(au.indexOf("<")==-1&&au.indexOf(">")==-1&&au.match(/^(?:https?:\/)?\/?(?:[^:\/\s]+)(?:(?:\/\w+)*\/)(?:[\w\-\.]+[^#?\s]+)(?:.*)?(?:#[\w\-]+)?$/)){av=au}}if(av&&L){au=L(av)||""}if(!au.length&&av){au='<video src="'+A(av)+'" />'}al.insertHTML(au).closePopup().collapseSelection()};var am=f("<div/>").addClass("wysiwyg-toolbar-form").attr("unselectable","on");var an=f("<textarea>").addClass("wysiwyg-input wysiwyg-inputtextarea");if(D){an.attr("placeholder",D)}f("<div/>").addClass("wysiwyg-embedcode").append(an).appendTo(am);var aq=X(F);var ar=f('<input type="text" value="" />').addClass("wysiwyg-input").keypress(function(at){if(at.which==10||at.which==13){ao(ar.val())}});if(ah){ar.attr("placeholder",ah)}var ap=aq.click(function(at){ao(ar.val(),an.val());at.stopPropagation();at.preventDefault();return false});am.append(f("<div/>").append(ar).append(ap));return am};var Q=function(am,ao){var al=f("<table/>").attr("cellpadding","0").attr("cellspacing","0").attr("unselectable","on");for(var ax=1;ax<15;++ax){var av=f("<tr/>");for(var an=0;an<25;++an){var ap;if(an==24){var aw=Math.floor(255/13*(14-ax)).toString(16);var at=(aw.length<2?"0":"")+aw;ap="#"+at+at+at}else{var ar=an/24;var aq=ax<=8?ax/8:1;var au=ax>8?(16-ax)/8:1;ap=h(ar,aq,au)}f("<td/>").addClass("wysiwyg-toolbar-color").attr("title",ap).attr("unselectable","on").css({backgroundColor:ap}).click(function(){var ay=this.title;if(ao){am.forecolor(ay).closePopup().collapseSelection()}else{am.highlight(ay).closePopup().collapseSelection()}return false}).appendTo(av)}al.append(av)}return al};var T=function(al,am){switch(al){case"insertimage":if(!am){return null}return function(an){am(W(C),an)};case"insertvideo":if(!am){return null}return function(an){am(ag(C),an)};case"insertlink":if(!am){return null}return function(an){am(ae(C),an)};case"bold":return function(){C.bold()};case"italic":return function(){C.italic()};case"underline":return function(){C.underline()};case"strikethrough":return function(){C.strikethrough()};case"forecolor":if(!am){return null}return function(an){am(Q(C,true),an)};case"highlight":if(!am){return null}return function(an){am(Q(C,false),an)};case"alignleft":return function(){C.align("left")};case"aligncenter":return function(){C.align("center")};case"alignright":return function(){C.align("right")};case"alignjustify":return function(){C.align("justify")};case"subscript":return function(){C.subscript()};case"superscript":return function(){C.superscript()};case"indent":return function(){C.indent()};case"outdent":return function(){C.indent(true)};case"orderedList":return function(){C.insertList(true)};case"unorderedList":return function(){C.insertList()};case"removeformat":return function(){C.removeFormat().closePopup().collapseSelection()}}return null};var X=function(al){return f("<a/>").addClass("wysiwyg-toolbar-icon").attr("href","#").attr("title",al.title).attr("unselectable","on").append(al.image)};var Z=function(al,am,an,ao){f.each(ac,function(ap,at){if(!at){return}if(am===false&&"showstatic" in at&&!at.showstatic){return}if(am===true&&"showselection" in at&&!at.showselection){return}var ar;if("click" in at){ar=function(au){at.click(f(au))
}}else{if("popup" in at){ar=function(av){var aw=an();var au=at.popup(aw,f(av));ao(aw,av,au)}}else{ar=T(ap,function(au,av){var aw=an();aw.append(au);ao(aw,av);aw.find("input[type=text]:first").focus()})}}var aq;if(ar){aq=X(at).click(function(au){ar(au.currentTarget);if(T(ap)){C.getElement().focus()}au.stopPropagation();au.preventDefault();return false})}else{if(at.html){aq=f(at.html)}}if(aq){al.append(aq)}})};var ak=function(al,aA,ap,ax){var az=aA.get(0).offsetParent,ar={left:0,top:0},av=false,am=false,ay=al.width(),ao=az;while(ao){ar.left+=ao.offsetLeft;ar.top+=ao.offsetTop;var an=f(ao);if(an.css("position")=="fixed"){av=true}if(an.css("overflow")!="visible"){am=true}ao=ao.offsetParent}var aw=f(az||u.body);aw.append(al);var aq=aA.position();ap+=aq.left;ax+=aq.top;if(av||am){if(ap+ay>aw.width()-1){ap=aw.width()-ay-1}if(ap<1){ap=1}}var au=f(m).width();if(ar.left+ap+ay>au-1){ap=au-ar.left-ay-1}var at=av?0:f(m).scrollLeft();if(ar.left+ap<at+1){ap=at-ar.left+1}al.css({left:parseInt(ap)+"px",top:parseInt(ax)+"px"})};var N={},ai=null;var S=function(ar,aq,ap){var ao=function(ay,aC,az,aB,av,aw,aA){if(!O){return}var ax=ai||"";switch(aC){case 8:ax=ax.substring(0,ax.length-1);case 13:case 27:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:if(ay){return}az=false;break;default:if(!ay){return}ax+=az;break}var au=O(ax,aC,az,aB,av,aw,aA);if(typeof(au)=="object"&&au.length){var at=f(al.openPopup());at.hide().addClass("wysiwyg-popup wysiwyg-popuphover").empty().append(au);ai=ax}else{al.closePopup();ai=null;return au}};var an={element:ar.get(0),onKeyDown:function(av,ax,au,aw,az,ay){if(aa&&aa(av,ax,au,aw,az,ay)===false){return false}if(ax&&!au&&!aw&&az&&!ay){var at=ax.toLowerCase();if(!N[at]){return}N[at]();return false}return ao(false,av,ax,au,aw,az,ay)},onKeyPress:function(au,aw,at,av,ay,ax){if(af&&af(au,aw,at,av,ay,ax)===false){return false}return ao(true,au,aw,at,av,ay,ax)},onKeyUp:function(au,aw,at,av,ay,ax){if(K&&K(au,aw,at,av,ay,ax)===false){return false}},onSelection:function(aA,ax,au,av){var aw=true,at=null;if(aA){f.each(au,function(aB,aC){if(f(aC).parents("a").length!=0){at=ae(al,f(aC).parents("a:first"));return false}})}if(!ax){aw=false}else{if(at){}else{if(av){}else{if(ai){}else{if(G!="selection"&&G!="top-selection"&&G!="bottom-selection"){aw=false}else{if(aA){aw=false}else{if(au.length==1&&au[0].nodeName=="IMG"){aw=false}}}}}}}if(!aw){al.closePopup();return}var az;var ay=function(){var aF=az.outerWidth();var aE=aq.offset(),aB=f(al.getElement()).offset();var aD=ax.left+parseInt(ax.width/2)-parseInt(aF/2)+aB.left-aE.left;var aC=ax.top+ax.height+aB.top-aE.top;ak(az,aq,aD,aC)};az=f(al.openPopup());if(!az.hasClass("wysiwyg-popuphover")||(!az.data("special"))!=(!at)){az=f(al.closePopup().openPopup())}if(ai){az.show()}else{if(!az.hasClass("wysiwyg-popup")){az.addClass("wysiwyg-popup wysiwyg-popuphover");if(at){az.empty().append(at).data("special",true)}else{Z(az,true,function(){return az.empty()},ay)}}}ay()},onClosepopup:function(){ai=null},hijackContextmenu:(G=="selection")};if(ap){var am=f("<div/>").addClass("wysiwyg-placeholder").html(ap).hide();aq.prepend(am);an.onPlaceholder=function(at){if(at){am.show()}else{am.hide()}}}var al=b(an);return al};var U=f("<div/>").addClass("wysiwyg-container");if(ad){U.addClass(ad)}ab.wrap(U);U=ab.parent(".wysiwyg-container");var V=false;if(I){V=f("<div/>").addClass("wysiwyg-wrapper").click(function(){C.getElement().focus()});ab.wrap(V);V=ab.parent(".wysiwyg-wrapper")}var C=S(ab,I?V:U,I);if(C.legacy){var ab=f(C.getElement());ab.addClass("wysiwyg-textarea");if(ab.is(":visible")){ab.width(U.width()-(ab.outerWidth()-ab.width()))}}else{f(C.getElement()).addClass("wysiwyg-editor")}var H={};f.each(ac,function(al,an){if(!an||!an.hotkey){return}var am=T(al);if(!am){return}N[an.hotkey.toLowerCase()]=am;H[al]=am});if(G!="selection"){var M=G=="top"||G=="top-selection";var aj=f("<div/>").addClass("wysiwyg-toolbar").addClass(M?"wysiwyg-toolbar-top":"wysiwyg-toolbar-bottom");Z(aj,false,function(){var al=f(C.openPopup());if(al.hasClass("wysiwyg-popup")&&al.hasClass("wysiwyg-popuphover")){al=f(C.closePopup().openPopup())
}if(!al.hasClass("wysiwyg-popup")){al.addClass("wysiwyg-popup")}return al},function(aq,ap,al){var am=f(ap);var ar=aq.outerWidth();var ao=am.offset().left-U.offset().left+parseInt(am.width()/2)-parseInt(ar/2);var an=am.offset().top-U.offset().top;if(M){an+=am.outerHeight()}else{an-=aq.outerHeight()}if(al){ao=al.left;an=al.top}ak(aq,U,ao,an)});if(M){U.prepend(aj)}else{U.append(aj)}}return{wysiwygeditor:C,$container:U}};f.fn.wysiwyg=function(C,E){if(!C||typeof(C)==="object"){C=f.extend({},C);return this.each(function(){var P=f(this);if(P.data("wysiwyg")){return}var T=C.classes,J=C.placeholder||P.attr("placeholder"),I=(C.toolbar&&(C.toolbar=="top"||C.toolbar=="top-selection"||C.toolbar=="bottom"||C.toolbar=="bottom-selection"||C.toolbar=="selection"))?C.toolbar:"top-selection",S=C.buttons,H=C.submit,Q=C.selectImage,V=C.placeholderUrl||null,F=C.placeholderEmbed||null,O=C.maxImageSize||null,K=C.onImageUpload||null,G=C.forceImageUpload&&K,M=C.videoFromUrl||null,R=C.onKeyDown||null,U=C.onKeyPress||null,L=C.onKeyUp||null,N=C.onAutocomplete||null;var W=s(P,T,J,I,S,H,Q,V,F,O,K,G,M,R,U,L,N);P.data("wysiwyg",W)})}else{if(this.length==1){var D=this.data("wysiwyg");if(!D){return this}if(C=="container"){return D.$container}if(C=="shell"){return D.wysiwygeditor}}}return this}}));