(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],function(b){return a(window,document,navigator,b)})}else{if(typeof exports!=="undefined"){module.exports=a(window,document,navigator,require("jquery"))}else{return a(window,document,navigator,jQuery)}}}(function(l,t,a,e,f){var d=function(D,C,A){var B;return function(){if(B){if(!A){return}clearTimeout(B)}var F=this,E=arguments;B=setTimeout(function(){B=null;D.apply(F,E)},C)}};var u=function(B,D,C,A){if(B.addEventListener){B.addEventListener(D,C,A?true:false)}else{if(B.attachEvent){B.attachEvent("on"+D,C)}else{if(B!=l){B["on"+D]=C}}}};var w=function(B,D,C,A){if(B.removeEventListener){B.removeEventListener(D,C,A?true:false)}else{if(B.detachEvent){B.detachEvent("on"+D,C)}else{if(B!=l){B["on"+D]=null}}}};var z=function(C,D,B,A){if(t.createEvent){var E=t.createEvent("Event");E.initEvent(D,B!==f?B:true,A!==f?A:false);C.dispatchEvent(E)}else{if(t.createEventObject){var E=t.createEventObject();C.fireEvent("on"+D,E)}else{if(typeof(C["on"+D])=="function"){C["on"+D]()}}}};var x=function(A){if(A.preventDefault){A.preventDefault()}else{A.returnValue=false}if(A.stopPropagation){A.stopPropagation()}else{A.cancelBubble=true}return false};var q=typeof(Node)!="undefined"?Node.ELEMENT_NODE:1;var i=typeof(Node)!="undefined"?Node.TEXT_NODE:3;var o=function(A,B){var C=B;while(C){if(C===A){return true}C=C.parentNode}return false};var c=function(B,A){if(B.firstChild){return B.firstChild}while(B){if(B==A){return null}if(B.nextSibling){return B.nextSibling}B=B.parentNode}return null};var s=function(A){if(l.getSelection){var B=l.getSelection();if(B.rangeCount>0){return B.getRangeAt(0)}}else{if(t.selection){var B=t.selection;return B.createRange()}}return null};var n=function(A,C){if(!C){return}if(l.getSelection){var B=l.getSelection();B.removeAllRanges();B.addRange(C)}else{if(t.selection){C.select()}}};var k=function(){if(l.getSelection){var C=l.getSelection();if(!C.rangeCount){return false}var A=C.getRangeAt(0).cloneRange();if(A.getBoundingClientRect){var B=A.getBoundingClientRect();if(!B||(B.left==0&&B.top==0&&B.right==0&&B.bottom==0)){return false}return{left:parseInt(B.left),top:parseInt(B.top),width:parseInt(B.right-B.left),height:parseInt(B.bottom-B.top)}}}else{if(t.selection){var C=t.selection;if(C.type!="Control"){var A=C.createRange();return{left:A.boundingLeft,top:A.boundingTop,width:A.boundingWidth,height:A.boundingHeight}}}}return false};var j=function(B){if(l.getSelection){var D=l.getSelection();if(D.isCollapsed){return true}return false}else{if(t.selection){var D=t.selection;if(D.type=="Text"){var C=t.selection.createRange();var A=t.body.createTextRange();A.moveToElementText(B);A.setEndPoint("EndToStart",C);return C.htmlText.length==0}if(D.type=="Control"){return false}}}return true};var m=function(E){if(l.getSelection){var C=l.getSelection();if(!C.rangeCount){return[]}var B=[];for(var I=0;I<C.rangeCount;++I){var K=C.getRangeAt(I),D=K.startContainer,L=K.endContainer;while(D){if(D!=E){var M=false;if(C.containsNode){M=C.containsNode(D,true)}else{var H=t.createRange();H.selectNodeContents(D);for(var I=0;I<C.rangeCount;++I){var K=C.getRangeAt(I);if(K.compareBoundaryPoints(K.END_TO_START,H)>=0&&K.compareBoundaryPoints(K.START_TO_END,H)<=0){M=true;break}}}if(M){B.push(D)}}D=c(D,D==L?L:E)}}if(B.length==0&&o(E,C.focusNode)&&C.focusNode!=E){B.push(C.focusNode)}return B}else{if(t.selection){var C=t.selection;if(C.type=="Text"){var B=[];var A=C.createRangeCollection();for(var I=0;I<A.length;++I){var K=A[I],J=K.parentElement(),D=J;while(D){var H=K.duplicate();H.moveToElementText(D.nodeType!=q?D.parentNode:D);if(H.compareEndPoints("EndToStart",K)>=0&&H.compareEndPoints("StartToEnd",K)<=0){var G=false;for(var F=0;F<B.length;++F){if(B[F]!==D){continue}G=true;break}if(!G){B.push(D)}}D=c(D,J)}}if(B.length==0&&o(E,t.activeElement)&&t.activeElement!=E){B.push(t.activeElement)}return B}if(C.type=="Control"){var B=[];var K=C.createRange();for(var I=0;I<K.length;++I){B.push(K(I))}return B}}}return[]};var h=function(){if(l.getSelection){var B=l.getSelection();if(!B.isCollapsed){B.collapseToEnd()
}}else{if(t.selection){var B=t.selection;if(B.type!="Control"){var A=B.createRange();A.collapse(false);A.select()}}}};var v=function(B){if(j(B)){return null}if(l.getSelection){var G=l.getSelection();if(G.rangeCount){var C=t.createElement("div"),A=G.rangeCount;for(var E=0;E<A;++E){var F=G.getRangeAt(E).cloneContents();C.appendChild(F)}return C.innerHTML}}else{if(t.selection){var G=t.selection;if(G.type=="Text"){var D=G.createRange();return D.htmlText}}}return null};var p=function(A,E){if(l.getSelection){var D=l.getSelection();if(o(A,D.anchorNode)&&o(A,D.focusNode)){return true}if(!E){return false}var B=t.createRange();B.selectNodeContents(A);B.collapse(false);D.removeAllRanges();D.addRange(B)}else{if(t.selection){var D=t.selection;if(D.type=="Control"){var B=D.createRange();if(B.length!=0&&o(A,B(0))){return true}}else{var C=t.body.createTextRange();C.moveToElementText(A);var B=D.createRange();if(C.inRange(B)){return true}}if(!E){return false}var B=t.body.createTextRange();B.moveToElementText(A);B.setEndPoint("StartToEnd",B);B.select()}}return true};var y=function(E,G){if(l.getSelection){var B=l.getSelection();if(B.getRangeAt&&B.rangeCount){var H=B.getRangeAt(0);var C=t.createElement("div");C.innerHTML=G;var I=t.createDocumentFragment(),D,A;while((D=C.firstChild)){A=I.appendChild(D)}if(o(E,H.commonAncestorContainer)){H.deleteContents();H.insertNode(I)}else{E.appendChild(I)}if(A){H=H.cloneRange();H.setStartAfter(A);H.collapse(true);B.removeAllRanges();B.addRange(H)}}}else{if(t.selection){var B=t.selection;if(B.type!="Control"){var F=B.createRange();F.collapse(true);var H=B.createRange();if(o(E,H.parentElement())){H.pasteHTML(G)}else{var J=t.body.createTextRange();J.moveToElementText(E);J.collapse(false);J.select();J.pasteHTML(G)}H=B.createRange();H.setEndPoint("StartToEnd",F);H.select()}}}};var b=function(Z){Z=Z||{};var T=Z.element||null;var af=Z.onkeypress||null;var R=Z.onselection||null;var aa=Z.onplaceholder||null;var ac=Z.hijackcontextmenu||false;var Q=T.nodeName=="TEXTAREA"||T.nodeName=="INPUT";if(Q){var Y="contentEditable" in t.body;if(Y){var H=a.userAgent.match(/(?:iPad|iPhone|Android).* AppleWebKit\/([^ ]+)/);if(H&&420<=parseInt(H[1])&&parseInt(H[1])<534){Y=false}}if(!Y){var K=T;var ad=function(al){return al.replace(/<br[ \/]*>\n?/gi,"<br>\n")};K.value=ad(K.value);var ai=function(){return this};var C=function(){return null};return{legacy:true,getElement:function(){return K},getHTML:function(){return K.value},setHTML:function(al){K.value=ad(al);return this},getSelectedHTML:C,sync:ai,collapseSelection:ai,openPopup:C,closePopup:ai,removeFormat:ai,bold:ai,italic:ai,underline:ai,strikethrough:ai,forecolor:ai,highlight:ai,fontName:ai,fontSize:ai,subscript:ai,superscript:ai,align:ai,format:ai,indent:ai,insertLink:ai,insertImage:ai,insertHTML:ai,insertList:ai}}}var K=null,ak=null;if(Q){K=T;K.style.display="none";ak=t.createElement("DIV");ak.innerHTML=K.value;var M=K.parentNode,B=K.nextSibling;if(B){M.insertBefore(ak,B)}else{M.appendChild(ak)}}else{ak=T}ak.setAttribute("contentEditable","true");var P=(t.all&&!t.addEventListener)?t:l;var S=null;if(Q){var I=ak.innerHTML;S=function(){var al=ak.innerHTML;if(al==I){return}K.value=al;I=al;z(K,"change",false)}}var X;if(aa){var O=false;X=function(){var an=true;var al=ak;while(al){al=c(al,ak);if(!al){}else{if(al.nodeType==q){if(al.nodeName=="IMG"){an=false;break}}else{if(al.nodeType==i){var am=al.nodeValue;if(am&&am.search(/[^\s]/)!=-1){an=false;break}}}}}if(O!=an){aa(an);O=an}};X()}var V=null,G=null,U=null;if(R){G=function(ao,am,ax){var au=j(ak);var an=m(ak);var aw=(ao===null||am===null)?null:{left:ao,top:am,width:0,height:0};var al=k();if(al){aw=al}if(aw){if(ak.getBoundingClientRect){var ay=ak.getBoundingClientRect();aw.left-=parseInt(ay.left);aw.top-=parseInt(ay.top)}else{var ar=ak,aq=0,ap=0,at=false;do{aq+=ar.offsetLeft?parseInt(ar.offsetLeft):0;ap+=ar.offsetTop?parseInt(ar.offsetTop):0;if(ar.style.position=="fixed"){at=true}}while(ar=ar.offsetParent);aw.left-=aq-(at?0:l.pageXOffset);aw.top-=ap-(at?0:l.pageYOffset)}if(aw.left<0){aw.left=0}if(aw.top<0){aw.top=0}if(aw.width>ak.offsetWidth){aw.width=ak.offsetWidth
}if(aw.height>ak.offsetHeight){aw.height=ak.offsetHeight}}else{if(an.length){for(var av=0;av<an.length;++av){var ar=an[av];if(ar.nodeType!=q){continue}aw={left:ar.offsetLeft,top:ar.offsetTop,width:ar.offsetWidth,height:ar.offsetHeight};break}}}R(au,aw,an,ax)};U=d(G,1)}var ae=null;var F=function(am){if(!am){var am=l.event}var al=am.target||am.srcElement;if(al.nodeType==i){al=al.parentNode}if(o(ae,al)){return}aj()};var ab=function(){if(ae){return ae}u(P,"mousedown",F,true);ae=t.createElement("DIV");var am=ak.parentNode,al=ak.nextSibling;if(al){am.insertBefore(ae,al)}else{am.appendChild(ae)}return ae};var aj=function(){if(!ae){return}ae.parentNode.removeChild(ae);ae=null;w(P,"mousedown",F,true)};u(ak,"focus",function(){if(K){z(K,"focus",false)}});u(ak,"blur",function(){if(S){S()}if(K){z(K,"blur",false)}});var D=null;if(X||S){var E=S?d(S,250,true):null;var ag=function(al){if(X){X()}if(E){E()}};D=d(ag,1);u(ak,"input",D);u(ak,"DOMNodeInserted",D);u(ak,"DOMNodeRemoved",D);u(ak,"DOMSubtreeModified",D);u(ak,"DOMCharacterDataModified",D);u(ak,"propertychange",D);u(ak,"textInput",D);u(ak,"paste",D);u(ak,"cut",D);u(ak,"drop",D)}var L=function(ao,al){if(!ao){var ao=l.event}var am=0;if(ao.keyCode){am=ao.keyCode}else{if(ao.which){am=ao.which}}var an=ao.charCode;if(al==1&&af){var ap=af(am,an?String(String):String.fromCharCode(am),ao.shiftKey||false,ao.altKey||false,ao.ctrlKey||false,ao.metaKey||false);if(ap===false){return x(ao)}}if(al==2||al==3){V=null;if(U){U(null,null,false)}}if(al==2&&D){switch(am){case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:break;default:D();break}}};u(ak,"keydown",function(al){return L(al,1)});u(ak,"keypress",function(al){return L(al,2)});u(ak,"keyup",function(al){return L(al,3)});var ah=function(ao,al){if(!ao){var ao=l.event}var an=null,am=null;if(ao.clientX&&ao.clientY){an=ao.clientX;am=ao.clientY}else{if(ao.pageX&&ao.pageY){an=ao.pageX-l.pageXOffset;am=ao.pageY-l.pageYOffset}}if(ao.which&&ao.which==3){al=true}else{if(ao.button&&ao.button==2){al=true}}w(P,"mouseup",ah);V=null;if(!ac&&al){return}if(U){U(an,am,al)}};u(ak,"mousedown",function(al){w(P,"mouseup",ah);u(P,"mouseup",ah)});u(ak,"mouseup",function(al){ah(al);if(D){D()}});u(ak,"dblclick",function(al){ah(al)});u(ak,"selectionchange",function(al){ah(al)});if(ac){u(ak,"contextmenu",function(al){ah(al,true);return x(al)})}var A=function(aq,ap,an){n(ak,V);if(!p(ak,an)){return false}if(l.getSelection){try{if(t.queryCommandSupported&&!t.queryCommandSupported(aq)){return false}return t.execCommand(aq,false,ap)}catch(ao){}}else{if(t.selection){var am=t.selection;if(am.type!="None"){var al=am.createRange();try{if(!al.queryCommandEnabled(aq)){return false}return al.execCommand(aq,false,ap)}catch(ao){}}}}return false};var J=null;var N=function(){if("ActiveXObject" in l){J=t.createElement("DIV");ak.appendChild(J)}};var W=function(al){if(J){ak.removeChild(J);J=null}if(D){D()}if(al){h();V=null}else{if(V){V=s(ak)}}};return{getElement:function(){return ak},getHTML:function(){return ak.innerHTML},setHTML:function(al){ak.innerHTML=al;W(true);return this},getSelectedHTML:function(){n(ak,V);if(!p(ak)){return null}return v(ak)},sync:function(){if(S){S()}return this},collapseSelection:function(){h();V=null;return this},openPopup:function(){if(!V){V=s(ak)}return ab()},closePopup:function(){aj();return this},removeFormat:function(){A("removeFormat");A("unlink");W();return this},bold:function(){A("bold");W();return this},italic:function(){A("italic");W();return this},underline:function(){A("underline");W();return this},strikethrough:function(){A("strikeThrough");W();return this},forecolor:function(al){A("foreColor",al);W();return this},highlight:function(al){if(!A("hiliteColor",al)){A("backColor",al)}W();return this},fontName:function(al){A("fontName",al);W();return this},fontSize:function(al){A("fontSize",al);W();return this},subscript:function(){A("subscript");W();return this},superscript:function(){A("superscript");W();return this},align:function(al){N();if(al=="left"){A("justifyLeft")}else{if(al=="center"){A("justifyCenter")}else{if(al=="right"){A("justifyRight")
}else{if(al=="justify"){A("justifyFull")}}}}W();return this},format:function(al){N();A("formatBlock",al);W();return this},indent:function(al){N();A(al?"outdent":"indent");W();return this},insertLink:function(al){A("createLink",al);W(true);return this},insertImage:function(al){A("insertImage",al,true);W(true);return this},insertHTML:function(al){if(!A("insertHTML",al,true)){n(ak,V);p(ak,true);y(ak,al)}W(true);return this},insertList:function(al){N();A(al?"insertOrderedList":"insertUnorderedList");W();return this}}};var g=function(F,N,L){var A,G,J,E,I,C,B,M;E=Math.floor(F*6);I=F*6-E;C=L*(1-N);B=L*(1-I*N);M=L*(1-(1-I)*N);switch(E%6){case 0:A=L,G=M,J=C;break;case 1:A=B,G=L,J=C;break;case 2:A=C,G=L,J=M;break;case 3:A=C,G=B,J=L;break;case 4:A=M,G=C,J=L;break;case 5:A=L,G=C,J=B;break}var K=Math.floor(A*255).toString(16);var D=Math.floor(G*255).toString(16);var H=Math.floor(J*255).toString(16);return"#"+(K.length<2?"0":"")+K+(D.length<2?"0":"")+D+(H.length<2?"0":"")+H};var r=function(W,Y,G,E,X,D,N,ac,B,L,H,C,I,aa){var U=function(af,ag){if(!ag){}else{if(af.getSelectedHTML()){af.insertLink(ag)}else{af.insertHTML('<a href="'+ag.replace(/"/,"&quot;")+'">'+ag+"</a>")}}af.closePopup().collapseSelection()};var Z=function(af,aj){var ai=T(D);var ak=e('<input type="text" value="'+(aj?aj.attr("href"):"")+'" />').addClass("wysiwyg-input").keypress(function(al){if(al.which!=10&&al.which!=13){return}if(aj){aj.attr("href",ak.val());af.closePopup().collapseSelection()}else{try{U(af,ak.val())}catch(am){af.closePopup()}}});if(ac){ak.attr("placeholder",ac)}var ah=ai.click(function(al){if(aj){aj.attr("href",ak.val());af.closePopup().collapseSelection()}else{U(af,ak.val())}al.stopPropagation();al.preventDefault();return false});var ag=e("<div/>").addClass("wysiwyg-toolbar-form").attr("unselectable","on");ag.append(ak).append(ah);return ag};var S=function(aj){var ah=function(aq,ap){var ar='<img id="wysiwyg-insert-image" src="" alt=""'+(ap?' title="'+ap.replace(/"/,"&quot;")+'"':"")+" />";aj.insertHTML(ar).closePopup().collapseSelection();var at=e("#wysiwyg-insert-image").removeAttr("id");if(L){at.css({maxWidth:L[0]+"px",maxHeight:L[1]+"px"}).load(function(){at.css({maxWidth:"",maxHeight:""});var av=at.width(),au=at.height();if(av>L[0]||au>L[1]){if((av/au)>(L[0]/L[1])){au=parseInt(au/av*L[0]);av=L[0]}else{av=parseInt(av/au*L[1]);au=L[1]}at.attr("width",av).attr("height",au)}})}at.attr("src",aq)};var ai=e("<div/>").addClass("wysiwyg-toolbar-form").attr("unselectable","on");var am=null,ao=e('<input type="file" />').css({position:"absolute",left:0,top:0,width:"100%",height:"100%",opacity:0,cursor:"pointer"});if(!C&&l.File&&l.FileReader&&l.FileList){var ak=function(aq){if(!aq.type.match("image.*")){return}var ap=new FileReader();ap.onload=function(at){var ar=at.target.result;ah(ar,aq.name)};ap.readAsDataURL(aq)};am=ao.attr("draggable","true").change(function(ar){var aq=ar.target.files;for(var ap=0;ap<aq.length;++ap){ak(aq[ap])}}).on("dragover",function(ap){ap.originalEvent.dataTransfer.dropEffect="copy";ap.stopPropagation();ap.preventDefault();return false}).on("drop",function(ar){var aq=ar.originalEvent.dataTransfer.files;for(var ap=0;ap<aq.length;++ap){ak(aq[ap])}ar.stopPropagation();ar.preventDefault();return false})}else{if(H){var an=ao.change(function(ap){H.call(this,ah)});am=e("<form/>").append(an)}}if(am){e("<div/>").addClass("wysiwyg-browse").html(N).append(am).appendTo(ai)}var af=T(D);var al=e('<input type="text" value="" />').addClass("wysiwyg-input").keypress(function(ap){if(ap.which==10||ap.which==13){ah(al.val())}});if(ac){al.attr("placeholder",ac)}var ag=af.click(function(ap){ah(al.val());ap.stopPropagation();ap.preventDefault();return false});ai.append(e("<div/>").append(al).append(ag));return ai};var ab=function(af){var ai=function(am,an){am=e.trim(am||"");an=e.trim(an||"");var ao=false;if(am.length&&!an.length){ao=am}else{if(an.indexOf("<")==-1&&an.indexOf(">")==-1&&an.match(/^(?:https?:\/)?\/?(?:[^:\/\s]+)(?:(?:\/\w+)*\/)(?:[\w\-\.]+[^#?\s]+)(?:.*)?(?:#[\w\-]+)?$/)){ao=an}}if(ao&&I){an=I(ao)||""}if(!an.length&&ao){an='<video src="'+ao.replace(/"/,"&quot;")+'" />'
}af.insertHTML(an).closePopup().collapseSelection()};var ag=e("<div/>").addClass("wysiwyg-toolbar-form").attr("unselectable","on");var ah=e("<textarea>").addClass("wysiwyg-input wysiwyg-inputtextarea");if(B){ah.attr("placeholder",B)}e("<div/>").addClass("wysiwyg-embedcode").append(ah).appendTo(ag);var ak=T(D);var al=e('<input type="text" value="" />').addClass("wysiwyg-input").keypress(function(am){if(am.which==10||am.which==13){ai(al.val())}});if(ac){al.attr("placeholder",ac)}var aj=ak.click(function(am){ai(al.val(),ah.val());am.stopPropagation();am.preventDefault();return false});ag.append(e("<div/>").append(al).append(aj));return ag};var M=function(ag,ai){var af=e("<table/>").attr("cellpadding","0").attr("cellspacing","0").attr("unselectable","on");for(var aq=1;aq<15;++aq){var ao=e("<tr/>");for(var ah=0;ah<25;++ah){var aj;if(ah==24){var ap=Math.floor(255/13*(14-aq)).toString(16);var am=(ap.length<2?"0":"")+ap;aj="#"+am+am+am}else{var al=ah/24;var ak=aq<=8?aq/8:1;var an=aq>8?(16-aq)/8:1;aj=g(al,ak,an)}e("<td/>").addClass("wysiwyg-toolbar-color").attr("title",aj).attr("unselectable","on").css({backgroundColor:aj}).click(function(){var ar=this.title;if(ai){ag.forecolor(ar).closePopup().collapseSelection()}else{ag.highlight(ar).closePopup().collapseSelection()}return false}).appendTo(ao)}af.append(ao)}return af};var P=function(af,ag){switch(af){case"insertimage":if(!ag){return null}return function(ah){ag(S(A),ah)};case"insertvideo":if(!ag){return null}return function(ah){ag(ab(A),ah)};case"insertlink":if(!ag){return null}return function(ah){ag(Z(A),ah)};case"bold":return function(){A.bold()};case"italic":return function(){A.italic()};case"underline":return function(){A.underline()};case"strikethrough":return function(){A.strikethrough()};case"forecolor":if(!ag){return null}return function(ah){ag(M(A,true),ah)};case"highlight":if(!ag){return null}return function(ah){ag(M(A,false),ah)};case"alignleft":return function(){A.align("left")};case"aligncenter":return function(){A.align("center")};case"alignright":return function(){A.align("right")};case"alignjustify":return function(){A.align("justify")};case"subscript":return function(){A.subscript()};case"superscript":return function(){A.superscript()};case"indent":return function(){A.indent()};case"outdent":return function(){A.indent(true)};case"orderedList":return function(){A.insertList(true)};case"unorderedList":return function(){A.insertList()};case"removeformat":return function(){A.removeFormat().closePopup().collapseSelection()}}return null};var T=function(af){return e("<a/>").addClass("wysiwyg-toolbar-icon").attr("href","#").attr("title",af.title).attr("unselectable","on").append(af.image)};var V=function(af,ag,ah,ai){e.each(X,function(aj,am){if(!am){return}if(ag===false&&"showstatic" in am&&!am.showstatic){return}if(ag===true&&"showselection" in am&&!am.showselection){return}var al;if("click" in am){al=function(an){am.click(e(an))}}else{if("popup" in am){al=function(ao){var ap=ah();var an=am.popup(ap,e(ao));ai(ap,ao,an)}}else{al=P(aj,function(an,ao){var ap=ah();ap.append(an);ai(ap,ao);ap.find("input[type=text]:first").focus()})}}var ak;if(al){ak=T(am).click(function(an){al(an.currentTarget);if(P(aj)){A.getElement().focus()}an.stopPropagation();an.preventDefault();return false})}else{if(am.html){ak=e(am.html)}}if(ak){af.append(ak)}})};var ae=function(af,au,aj,aq){var at=au.get(0).offsetParent,al={left:0,top:0},ao=false,ag=false,ar=af.width(),ai=at;while(ai){al.left+=ai.offsetLeft;al.top+=ai.offsetTop;var ah=e(ai);if(ah.css("position")=="fixed"){ao=true}if(ah.css("overflow")!="visible"){ag=true}ai=ai.offsetParent}var ap=e(at||t.body);ap.append(af);var ak=au.position();aj+=ak.left;aq+=ak.top;if(ao||ag){if(aj+ar>ap.width()-1){aj=ap.width()-ar-1}if(aj<1){aj=1}}var an=e(l).width();if(al.left+aj+ar>an-1){aj=an-al.left-ar-1}var am=ao?0:e(l).scrollLeft();if(al.left+aj<am+1){aj=am-al.left+1}af.css({left:parseInt(aj)+"px",top:parseInt(aq)+"px"})};var K={};var O=function(ak,aj,ai){var ah={element:ak.get(0),onkeypress:function(an,ap,am,ao,ar,aq){if(aa&&aa(an,ap,am,ao,ar,aq)===false){return false
}if(ap&&!am&&!ao&&ar&&!aq){var al=ap.toLowerCase();if(!K[al]){return}K[al]();return false}},onselection:function(at,ap,am,an){var ao=true,al=null;if(at){e.each(am,function(au,av){if(e(av).parents("a").length!=0){al=Z(af,e(av).parents("a:first"));return false}})}if(!ap){ao=false}else{if(al){}else{if(an){}else{if(E!="selection"&&E!="top-selection"&&E!="bottom-selection"){ao=false}else{if(at){ao=false}else{if(am.length==1&&am[0].nodeName=="IMG"){ao=false}}}}}}if(!ao){af.closePopup();return}var ar;var aq=function(){var ay=ar.outerWidth();var ax=aj.offset(),au=e(af.getElement()).offset();var aw=ap.left+parseInt(ap.width/2)-parseInt(ay/2)+au.left-ax.left;var av=ap.top+ap.height+au.top-ax.top;ae(ar,aj,aw,av)};ar=e(af.openPopup());if(ar.hasClass("wysiwyg-popup")&&!ar.hasClass("wysiwyg-popuphover")||ar.data("special")!=(!!al)){ar=e(af.closePopup().openPopup())}if(!ar.hasClass("wysiwyg-popup")){ar.addClass("wysiwyg-popup wysiwyg-popuphover");if(al){ar.empty().append(al).data("special",true)}else{V(ar,true,function(){return ar.empty()},aq)}}aq()},hijackcontextmenu:(E=="selection")};if(ai){var ag=e("<div/>").addClass("wysiwyg-placeholder").html(ai).hide();aj.prepend(ag);ah.onplaceholder=function(al){if(al){ag.show()}else{ag.hide()}}}var af=b(ah);return af};var Q=e("<div/>").addClass("wysiwyg-container");if(Y){Q.addClass(Y)}W.wrap(Q);Q=W.parent(".wysiwyg-container");var R=false;if(G){R=e("<div/>").addClass("wysiwyg-wrapper").click(function(){A.getElement().focus()});W.wrap(R);R=W.parent(".wysiwyg-wrapper")}var A=O(W,G?R:Q,G);if(A.legacy){var W=e(A.getElement());W.addClass("wysiwyg-textarea");if(W.is(":visible")){W.width(Q.width()-(W.outerWidth()-W.width()))}}else{e(A.getElement()).addClass("wysiwyg-editor")}var F={};e.each(X,function(af,ah){if(!ah||!ah.hotkey){return}var ag=P(af);if(!ag){return}K[ah.hotkey.toLowerCase()]=ag;F[af]=ag});if(E!="selection"){var J=E=="top"||E=="top-selection";var ad=e("<div/>").addClass("wysiwyg-toolbar").addClass(J?"wysiwyg-toolbar-top":"wysiwyg-toolbar-bottom");V(ad,false,function(){var af=e(A.openPopup());if(af.hasClass("wysiwyg-popup")&&af.hasClass("wysiwyg-popuphover")){af=e(A.closePopup().openPopup())}if(!af.hasClass("wysiwyg-popup")){af.addClass("wysiwyg-popup")}return af},function(ak,aj,af){var ag=e(aj);var al=ak.outerWidth();var ai=ag.offset().left-Q.offset().left+parseInt(ag.width()/2)-parseInt(al/2);var ah=ag.offset().top-Q.offset().top;if(J){ah+=ag.outerHeight()}else{ah-=ak.outerHeight()}if(af){ai=af.left;ah=af.top}ae(ak,Q,ai,ah)});if(J){Q.prepend(ad)}else{Q.append(ad)}}return{wysiwygeditor:A,$container:Q}};e.fn.wysiwyg=function(A,C){if(!A||typeof(A)==="object"){A=e.extend({},A);return this.each(function(){var J=e(this);if(J.data("wysiwyg")){return}var G=A.classes,P=A.placeholder||J.attr("placeholder"),E=(A.toolbar&&(A.toolbar=="top"||A.toolbar=="top-selection"||A.toolbar=="bottom"||A.toolbar=="bottom-selection"||A.toolbar=="selection"))?A.toolbar:"top-selection",H=A.buttons,O=A.submit,Q=A.selectImage,R=A.placeholderUrl||null,N=A.placeholderEmbed||null,D=A.maxImageSize||null,L=A.onImageUpload||null,F=A.forceImageUpload&&L,M=A.videoFromUrl||null,K=A.onKeyPress;var I=r(J,G,P,E,H,O,Q,R,N,D,L,F,M,K);J.data("wysiwyg",I)})}else{if(this.length==1){var B=this.data("wysiwyg");if(!B){return this}if(A=="container"){return B.$container}if(A=="shell"){return B.wysiwygeditor}}}return this}}));