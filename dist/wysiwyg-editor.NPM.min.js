(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],function(b){return a(window,document,b)})}else{if(typeof exports!=="undefined"){module.exports=a(window,document,require("jquery"))}else{return a(window,document,jQuery)}}}(function(j,r,c,d){var b=function(B,A,y){var z;return function(){if(z){if(!y){return}clearTimeout(z)}var D=this,C=arguments;z=setTimeout(function(){z=null;B.apply(D,C)},A)}};var s=function(z,B,A,y){if(z.addEventListener){z.addEventListener(B,A,y?true:false)}else{if(z.attachEvent){z.attachEvent("on"+B,A)}else{if(z!=j){z["on"+B]=A}}}};var u=function(z,B,A,y){if(z.removeEventListener){z.removeEventListener(B,A,y?true:false)}else{if(z.detachEvent){z.detachEvent("on"+B,A)}else{if(z!=j){z["on"+B]=null}}}};var x=function(A,B,z,y){if(r.createEvent){var C=r.createEvent("Event");C.initEvent(B,z!==d?z:true,y!==d?y:false);A.dispatchEvent(C)}else{if(r.createEventObject){var C=r.createEventObject();A.fireEvent("on"+B,C)}else{if(typeof(A["on"+B])=="function"){A["on"+B]()}}}};var v=function(y){if(y.preventDefault){y.preventDefault()}else{y.returnValue=false}if(y.stopPropagation){y.stopPropagation()}else{y.cancelBubble=true}return false};var o=typeof(Node)!="undefined"?Node.ELEMENT_NODE:1;var g=typeof(Node)!="undefined"?Node.TEXT_NODE:3;var m=function(y,z){var A=z;while(A){if(A===y){return true}A=A.parentNode}return false};var a=function(z,y){if(z.firstChild){return z.firstChild}while(z){if(z==y){return null}if(z.nextSibling){return z.nextSibling}z=z.parentNode}return null};var q=function(y){if(j.getSelection){var z=j.getSelection();if(z.rangeCount>0){return z.getRangeAt(0)}}else{if(r.selection){var z=r.selection;return z.createRange()}}return null};var l=function(y,A){if(!A){return}if(j.getSelection){var z=j.getSelection();z.removeAllRanges();z.addRange(A)}else{if(r.selection){A.select()}}};var h=function(){if(j.getSelection){var A=j.getSelection();if(!A.rangeCount){return false}var y=A.getRangeAt(0).cloneRange();if(y.getBoundingClientRect){var z=y.getBoundingClientRect();if(!z||(z.left==0&&z.top==0&&z.right==0&&z.bottom==0)){return false}return{left:parseInt(z.left),top:parseInt(z.top),width:parseInt(z.right-z.left),height:parseInt(z.bottom-z.top)}}}else{if(r.selection){var A=r.selection;if(A.type!="Control"){var y=A.createRange();return{left:y.boundingLeft,top:y.boundingTop,width:y.boundingWidth,height:y.boundingHeight}}}}return false};var i=function(z){if(j.getSelection){var B=j.getSelection();if(B.isCollapsed){return true}return false}else{if(r.selection){var B=r.selection;if(B.type=="Text"){var A=r.selection.createRange();var y=r.body.createTextRange();y.moveToElementText(z);y.setEndPoint("EndToStart",A);return A.htmlText.length==0}if(B.type=="Control"){return false}}}return true};var k=function(C){if(j.getSelection){var A=j.getSelection();if(!A.rangeCount){return[]}var z=[];for(var G=0;G<A.rangeCount;++G){var I=A.getRangeAt(G),B=I.startContainer,J=I.endContainer;while(B){if(B!=C){var K=false;if(A.containsNode){K=A.containsNode(B,true)}else{var F=r.createRange();F.selectNodeContents(B);for(var G=0;G<A.rangeCount;++G){var I=A.getRangeAt(G);if(I.compareBoundaryPoints(I.END_TO_START,F)>=0&&I.compareBoundaryPoints(I.START_TO_END,F)<=0){K=true;break}}}if(K){z.push(B)}}B=a(B,B==J?J:C)}}if(z.length==0&&m(C,A.focusNode)&&A.focusNode!=C){z.push(A.focusNode)}return z}else{if(r.selection){var A=r.selection;if(A.type=="Text"){var z=[];var y=A.createRangeCollection();for(var G=0;G<y.length;++G){var I=y[G],H=I.parentElement(),B=H;while(B){var F=I.duplicate();F.moveToElementText(B.nodeType!=o?B.parentNode:B);if(F.compareEndPoints("EndToStart",I)>=0&&F.compareEndPoints("StartToEnd",I)<=0){var E=false;for(var D=0;D<z.length;++D){if(z[D]!==B){continue}E=true;break}if(!E){z.push(B)}}B=a(B,H)}}if(z.length==0&&m(C,r.activeElement)&&r.activeElement!=C){z.push(r.activeElement)}return z}if(A.type=="Control"){var z=[];var I=A.createRange();for(var G=0;G<I.length;++G){z.push(I(G))}return z}}}return[]};var f=function(){if(j.getSelection){var z=j.getSelection();if(!z.isCollapsed){z.collapseToEnd()}}else{if(r.selection){var z=r.selection;
if(z.type!="Control"){var y=z.createRange();y.collapse(false);y.select()}}}};var t=function(z){if(i(z)){return null}if(j.getSelection){var E=j.getSelection();if(E.rangeCount){var A=r.createElement("div"),y=E.rangeCount;for(var C=0;C<y;++C){var D=E.getRangeAt(C).cloneContents();A.appendChild(D)}return A.innerHTML}}else{if(r.selection){var E=r.selection;if(E.type=="Text"){var B=E.createRange();return B.htmlText}}}return null};var n=function(y,C){if(j.getSelection){var B=j.getSelection();if(m(y,B.anchorNode)&&m(y,B.focusNode)){return true}if(!C){return false}var z=r.createRange();z.selectNodeContents(y);z.collapse(false);B.removeAllRanges();B.addRange(z)}else{if(r.selection){var B=r.selection;if(B.type=="Control"){var z=B.createRange();if(z.length!=0&&m(y,z(0))){return true}}else{var A=r.body.createTextRange();A.moveToElementText(y);var z=B.createRange();if(A.inRange(z)){return true}}if(!C){return false}var z=r.body.createTextRange();z.moveToElementText(y);z.setEndPoint("StartToEnd",z);z.select()}}return true};var w=function(C,E){if(j.getSelection){var z=j.getSelection();if(z.getRangeAt&&z.rangeCount){var F=z.getRangeAt(0);var A=r.createElement("div");A.innerHTML=E;var G=r.createDocumentFragment(),B,y;while((B=A.firstChild)){y=G.appendChild(B)}if(m(C,F.commonAncestorContainer)){F.deleteContents();F.insertNode(G)}else{C.appendChild(G)}if(y){F=F.cloneRange();F.setStartAfter(y);F.collapse(true);z.removeAllRanges();z.addRange(F)}}}else{if(r.selection){var z=r.selection;if(z.type!="Control"){var D=z.createRange();D.collapse(true);var F=z.createRange();if(m(C,F.parentElement())){F.pasteHTML(E)}else{var H=r.body.createTextRange();H.moveToElementText(C);H.collapse(false);H.select();H.pasteHTML(E)}F=z.createRange();F.setEndPoint("StartToEnd",D);F.select()}}}};j.wysiwyg=function(N){N=N||{};var z=N.element||null;var ag=N.onkeypress||null;var af=N.onselection||null;var A=N.onplaceholder||null;var C=N.hijackcontextmenu||false;var M=z.nodeName=="TEXTAREA"||z.nodeName=="INPUT";if(M){var U="contentEditable" in r.body;if(U){var y=navigator.userAgent.match(/(?:iPad|iPhone|Android).* AppleWebKit\/([^ ]+)/);if(y&&420<=parseInt(y[1])&&parseInt(y[1])<534){U=false}}if(!U){var ab=z;var G=function(ah){return ah.replace(/<br[ \/]*>\n?/gi,"<br>\n")};ab.value=G(ab.value);var E=function(){return this};var R=function(){return null};return{legacy:true,getElement:function(){return ab},getHTML:function(){return ab.value},setHTML:function(ah){ab.value=G(ah);return this},getSelectedHTML:R,sync:E,collapseSelection:E,openPopup:R,closePopup:E,removeFormat:E,bold:E,italic:E,underline:E,strikethrough:E,forecolor:E,highlight:E,fontName:E,fontSize:E,subscript:E,superscript:E,align:E,format:E,indent:E,insertLink:E,insertImage:E,insertHTML:E,insertList:E}}}var ab=null,V=null;if(M){ab=z;ab.style.display="none";V=r.createElement("DIV");V.innerHTML=ab.value;var J=ab.parentNode,Q=ab.nextSibling;if(Q){J.insertBefore(V,Q)}else{J.appendChild(V)}}else{V=z}V.setAttribute("contentEditable","true");var D=(r.all&&!r.addEventListener)?r:j;var O=null;if(M){var W=V.innerHTML;O=function(){var ah=V.innerHTML;if(ah==W){return}ab.value=ah;W=ah;x(ab,"change",false)}}var ad;if(A){var I=false;ad=function(){var aj=true;var ah=V;while(ah){ah=a(ah,V);if(!ah){}else{if(ah.nodeType==o){if(ah.nodeName=="IMG"){aj=false;break}}else{if(ah.nodeType==g){var ai=ah.nodeValue;if(ai&&ai.search(/[^\s]/)!=-1){aj=false;break}}}}}if(I!=aj){A(aj);I=aj}};ad()}var aa=null,T=null,B=null;if(af){T=function(ak,ai,at){var ap=i(V);var aj=k(V);var ar=(ak===null||ai===null)?null:{left:ak,top:ai,width:0,height:0};var ah=h();if(ah){ar=ah}if(ar){if(V.getBoundingClientRect){var au=V.getBoundingClientRect();ar.left-=parseInt(au.left);ar.top-=parseInt(au.top)}else{var an=V,am=0,al=0,ao=false;do{am+=an.offsetLeft?parseInt(an.offsetLeft):0;al+=an.offsetTop?parseInt(an.offsetTop):0;if(an.style.position=="fixed"){ao=true}}while(an=an.offsetParent);ar.left-=am-(ao?0:j.pageXOffset);ar.top-=al-(ao?0:j.pageYOffset)}if(ar.left<0){ar.left=0}if(ar.top<0){ar.top=0}if(ar.width>V.offsetWidth){ar.width=V.offsetWidth}if(ar.height>V.offsetHeight){ar.height=V.offsetHeight
}}else{if(aj.length){for(var aq=0;aq<aj.length;++aq){var an=aj[aq];if(an.nodeType!=o){continue}ar={left:an.offsetLeft,top:an.offsetTop,width:an.offsetWidth,height:an.offsetHeight};break}}}af(ap,ar,aj,at)};B=b(T,1)}var K=null;var ae=function(ai){if(!ai){var ai=j.event}var ah=ai.target||ai.srcElement;if(ah.nodeType==g){ah=ah.parentNode}if(m(K,ah)){return}P()};var Z=function(){if(K){return K}s(D,"mousedown",ae,true);K=r.createElement("DIV");var ai=V.parentNode,ah=V.nextSibling;if(ah){ai.insertBefore(K,ah)}else{ai.appendChild(K)}return K};var P=function(){if(!K){return}K.parentNode.removeChild(K);K=null;u(D,"mousedown",ae,true)};s(V,"focus",function(){if(ab){x(ab,"focus",false)}});s(V,"blur",function(){if(O){O()}if(ab){x(ab,"blur",false)}});var L=null;if(ad||O){var F=O?b(O,250,true):null;var Y=function(ah){if(ad){ad()}if(F){F()}};L=b(Y,1);s(V,"input",L);s(V,"DOMNodeInserted",L);s(V,"DOMNodeRemoved",L);s(V,"DOMSubtreeModified",L);s(V,"DOMCharacterDataModified",L);s(V,"propertychange",L);s(V,"textInput",L);s(V,"paste",L);s(V,"cut",L);s(V,"drop",L)}var ac=function(ak,ah){if(!ak){var ak=j.event}var ai=0;if(ak.keyCode){ai=ak.keyCode}else{if(ak.which){ai=ak.which}}var aj=ak.charCode;if(ah==1&&ag){var al=ag(ai,aj?String(String):String.fromCharCode(ai),ak.shiftKey||false,ak.altKey||false,ak.ctrlKey||false,ak.metaKey||false);if(al===false){return v(ak)}}if(ah==2||ah==3){aa=null;if(B){B(null,null,false)}}if(ah==2&&L){switch(ai){case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:break;default:L();break}}};s(V,"keydown",function(ah){return ac(ah,1)});s(V,"keypress",function(ah){return ac(ah,2)});s(V,"keyup",function(ah){return ac(ah,3)});var H=function(ak,ah){if(!ak){var ak=j.event}var aj=null,ai=null;if(ak.clientX&&ak.clientY){aj=ak.clientX;ai=ak.clientY}else{if(ak.pageX&&ak.pageY){aj=ak.pageX-j.pageXOffset;ai=ak.pageY-j.pageYOffset}}if(ak.which&&ak.which==3){ah=true}else{if(ak.button&&ak.button==2){ah=true}}u(D,"mouseup",H);aa=null;if(!C&&ah){return}if(B){B(aj,ai,ah)}};s(V,"mousedown",function(ah){u(D,"mouseup",H);s(D,"mouseup",H)});s(V,"mouseup",function(ah){H(ah);if(L){L()}});s(V,"dblclick",function(ah){H(ah)});s(V,"selectionchange",function(ah){H(ah)});if(C){s(V,"contextmenu",function(ah){H(ah,true);return v(ah)})}var X=function(am,al,aj){l(V,aa);if(!n(V,aj)){return false}if(j.getSelection){try{if(r.queryCommandSupported&&!r.queryCommandSupported(am)){return false}return r.execCommand(am,false,al)}catch(ak){}}else{if(r.selection){var ai=r.selection;if(ai.type!="None"){var ah=ai.createRange();try{if(!ah.queryCommandEnabled(am)){return false}return ah.execCommand(am,false,al)}catch(ak){}}}}return false};var S=function(ah){if(L){L()}if(ah){f();aa=null}else{if(aa){aa=q(V)}}};return{getElement:function(){return V},getHTML:function(){return V.innerHTML},setHTML:function(ah){V.innerHTML=ah;S(true);return this},getSelectedHTML:function(){l(V,aa);if(!n(V)){return null}return t(V)},sync:function(){if(O){O()}return this},collapseSelection:function(){f();aa=null;return this},openPopup:function(){if(!aa){aa=q(V)}return Z()},closePopup:function(){P();return this},removeFormat:function(){X("removeFormat");X("unlink");S();return this},bold:function(){X("bold");S();return this},italic:function(){X("italic");S();return this},underline:function(){X("underline");S();return this},strikethrough:function(){X("strikeThrough");S();return this},forecolor:function(ah){X("foreColor",ah);S();return this},highlight:function(ah){if(!X("hiliteColor",ah)){X("backColor",ah)}S();return this},fontName:function(ah){X("fontName",ah);S();return this},fontSize:function(ah){X("fontSize",ah);S();return this},subscript:function(){X("subscript");S();return this},superscript:function(){X("superscript");S();return this},align:function(ah){if(ah=="left"){X("justifyLeft")}else{if(ah=="center"){X("justifyCenter")}else{if(ah=="right"){X("justifyRight")}else{if(ah=="justify"){X("justifyFull")}}}}S();return this},format:function(ah){X("formatBlock",ah);S();return this},indent:function(ah){X(ah?"outdent":"indent");S();return this},insertLink:function(ah){X("createLink",ah);
S(true);return this},insertImage:function(ah){X("insertImage",ah,true);S(true);return this},insertHTML:function(ah){if(!X("insertHTML",ah,true)){l(V,aa);n(V,true);w(V,ah)}S(true);return this},insertList:function(ah){X(ah?"insertOrderedList":"insertUnorderedList");S();return this}}};var e=function(D,L,J){var y,E,H,C,G,A,z,K;C=Math.floor(D*6);G=D*6-C;A=J*(1-L);z=J*(1-G*L);K=J*(1-(1-G)*L);switch(C%6){case 0:y=J,E=K,H=A;break;case 1:y=z,E=J,H=A;break;case 2:y=A,E=J,H=K;break;case 3:y=A,E=z,H=J;break;case 4:y=K,E=A,H=J;break;case 5:y=J,E=A,H=z;break}var I=Math.floor(y*255).toString(16);var B=Math.floor(E*255).toString(16);var F=Math.floor(H*255).toString(16);return"#"+(I.length<2?"0":"")+I+(B.length<2?"0":"")+B+(F.length<2?"0":"")+F};var p=function(U,W,E,C,V,B,L,aa,z,J,F,A,G,Y){var S=function(ad,ae){if(!ae){}else{if(ad.getSelectedHTML()){ad.insertLink(ae)}else{ad.insertHTML('<a href="'+ae.replace(/"/,"&quot;")+'">'+ae+"</a>")}}ad.closePopup().collapseSelection()};var X=function(ad,ah){var ag=R(B);var ai=c('<input type="text" value="'+(ah?ah.attr("href"):"")+'" />').addClass("wysiwyg-input").keypress(function(aj){if(aj.which!=10&&aj.which!=13){return}if(ah){ah.attr("href",ai.val());ad.closePopup().collapseSelection()}else{try{S(ad,ai.val())}catch(ak){ad.closePopup()}}});if(aa){ai.attr("placeholder",aa)}var af=ag.click(function(aj){if(ah){ah.attr("href",ai.val());ad.closePopup().collapseSelection()}else{S(ad,ai.val())}aj.stopPropagation();aj.preventDefault();return false});var ae=c("<div/>").addClass("wysiwyg-toolbar-form").attr("unselectable","on");ae.append(ai).append(af);return ae};var Q=function(ah){var af=function(ao,an){var ap='<img id="wysiwyg-insert-image" src="" alt=""'+(an?' title="'+an.replace(/"/,"&quot;")+'"':"")+" />";ah.insertHTML(ap).closePopup().collapseSelection();var aq=c("#wysiwyg-insert-image").removeAttr("id");if(J){aq.css({maxWidth:J[0]+"px",maxHeight:J[1]+"px"}).load(function(){aq.css({maxWidth:"",maxHeight:""});var at=aq.width(),ar=aq.height();if(at>J[0]||ar>J[1]){if((at/ar)>(J[0]/J[1])){ar=parseInt(ar/at*J[0]);at=J[0]}else{at=parseInt(at/ar*J[1]);ar=J[1]}aq.attr("width",at).attr("height",ar)}})}aq.attr("src",ao)};var ag=c("<div/>").addClass("wysiwyg-toolbar-form").attr("unselectable","on");var ak=null,am=c('<input type="file" />').css({position:"absolute",left:0,top:0,width:"100%",height:"100%",opacity:0,cursor:"pointer"});if(!A&&j.File&&j.FileReader&&j.FileList){var ai=function(ao){if(!ao.type.match("image.*")){return}var an=new FileReader();an.onload=function(aq){var ap=aq.target.result;af(ap,ao.name)};an.readAsDataURL(ao)};ak=am.attr("draggable","true").change(function(ap){var ao=ap.target.files;for(var an=0;an<ao.length;++an){ai(ao[an])}}).on("dragover",function(an){an.originalEvent.dataTransfer.dropEffect="copy";an.stopPropagation();an.preventDefault();return false}).on("drop",function(ap){var ao=ap.originalEvent.dataTransfer.files;for(var an=0;an<ao.length;++an){ai(ao[an])}ap.stopPropagation();ap.preventDefault();return false})}else{if(F){var al=am.change(function(an){F.call(this,af)});ak=c("<form/>").append(al)}}if(ak){c("<div/>").addClass("wysiwyg-browse").html(L).append(ak).appendTo(ag)}var ad=R(B);var aj=c('<input type="text" value="" />').addClass("wysiwyg-input").keypress(function(an){if(an.which==10||an.which==13){af(aj.val())}});if(aa){aj.attr("placeholder",aa)}var ae=ad.click(function(an){af(aj.val());an.stopPropagation();an.preventDefault();return false});ag.append(c("<div/>").append(aj).append(ae));return ag};var Z=function(ad){var ag=function(ak,al){ak=c.trim(ak||"");al=c.trim(al||"");var am=false;if(ak.length&&!al.length){am=ak}else{if(al.indexOf("<")==-1&&al.indexOf(">")==-1&&al.match(/^(?:https?:\/)?\/?(?:[^:\/\s]+)(?:(?:\/\w+)*\/)(?:[\w\-\.]+[^#?\s]+)(?:.*)?(?:#[\w\-]+)?$/)){am=al}}if(am&&G){al=G(am)||""}if(!al.length&&am){al='<video src="'+am.replace(/"/,"&quot;")+'" />'}ad.insertHTML(al).closePopup().collapseSelection()};var ae=c("<div/>").addClass("wysiwyg-toolbar-form").attr("unselectable","on");var af=c("<textarea>").addClass("wysiwyg-input wysiwyg-inputtextarea");if(z){af.attr("placeholder",z)
}c("<div/>").addClass("wysiwyg-embedcode").append(af).appendTo(ae);var ai=R(B);var aj=c('<input type="text" value="" />').addClass("wysiwyg-input").keypress(function(ak){if(ak.which==10||ak.which==13){ag(aj.val())}});if(aa){aj.attr("placeholder",aa)}var ah=ai.click(function(ak){ag(aj.val(),af.val());ak.stopPropagation();ak.preventDefault();return false});ae.append(c("<div/>").append(aj).append(ah));return ae};var K=function(ae,ag){var ad=c("<table/>").attr("cellpadding","0").attr("cellspacing","0").attr("unselectable","on");for(var ao=1;ao<15;++ao){var am=c("<tr/>");for(var af=0;af<25;++af){var ah;if(af==24){var an=Math.floor(255/13*(14-ao)).toString(16);var ak=(an.length<2?"0":"")+an;ah="#"+ak+ak+ak}else{var aj=af/24;var ai=ao<=8?ao/8:1;var al=ao>8?(16-ao)/8:1;ah=e(aj,ai,al)}c("<td/>").addClass("wysiwyg-toolbar-color").attr("title",ah).attr("unselectable","on").css({backgroundColor:ah}).click(function(){var ap=this.title;if(ag){ae.forecolor(ap).closePopup().collapseSelection()}else{ae.highlight(ap).closePopup().collapseSelection()}return false}).appendTo(am)}ad.append(am)}return ad};var N=function(ad,ae){switch(ad){case"insertimage":if(!ae){return null}return function(af){ae(Q(y),af)};case"insertvideo":if(!ae){return null}return function(af){ae(Z(y),af)};case"insertlink":if(!ae){return null}return function(af){ae(X(y),af)};case"bold":return function(){y.bold()};case"italic":return function(){y.italic()};case"underline":return function(){y.underline()};case"strikethrough":return function(){y.strikethrough()};case"forecolor":if(!ae){return null}return function(af){ae(K(y,true),af)};case"highlight":if(!ae){return null}return function(af){ae(K(y,false),af)};case"alignleft":return function(){y.align("left")};case"aligncenter":return function(){y.align("center")};case"alignright":return function(){y.align("right")};case"alignjustify":return function(){y.align("justify")};case"subscript":return function(){y.subscript()};case"superscript":return function(){y.superscript()};case"indent":return function(){y.indent()};case"outdent":return function(){y.indent(true)};case"orderedList":return function(){y.insertList(true)};case"unorderedList":return function(){y.insertList()};case"removeformat":return function(){y.removeFormat().closePopup().collapseSelection()}}return null};var R=function(ad){return c("<a/>").addClass("wysiwyg-toolbar-icon").attr("href","#").attr("title",ad.title).attr("unselectable","on").append(ad.image)};var T=function(ad,ae,af,ag){c.each(V,function(ah,ak){if(!ak){return}if(ae===false&&"showstatic" in ak&&!ak.showstatic){return}if(ae===true&&"showselection" in ak&&!ak.showselection){return}var aj;if("click" in ak){aj=function(al){ak.click(c(al))}}else{if("popup" in ak){aj=function(am){var an=af();var al=ak.popup(an,c(am));ag(an,am,al)}}else{aj=N(ah,function(al,am){var an=af();an.append(al);ag(an,am);an.find("input[type=text]:first").focus()})}}var ai;if(aj){ai=R(ak).click(function(al){aj(al.currentTarget);if(N(ah)){y.getElement().focus()}al.stopPropagation();al.preventDefault();return false})}else{if(ak.html){ai=c(ak.html)}}if(ai){ad.append(ai)}})};var ac=function(ad,ar,ah,ao){var aq=ar.get(0).offsetParent,aj={left:0,top:0},am=false,ae=false,ap=ad.width(),ag=aq;while(ag){aj.left+=ag.offsetLeft;aj.top+=ag.offsetTop;var af=c(ag);if(af.css("position")=="fixed"){am=true}if(af.css("overflow")!="visible"){ae=true}ag=ag.offsetParent}var an=c(aq||r.body);an.append(ad);var ai=ar.position();ah+=ai.left;ao+=ai.top;if(am||ae){if(ah+ap>an.width()-1){ah=an.width()-ap-1}if(ah<1){ah=1}}var al=c(j).width();if(aj.left+ah+ap>al-1){ah=al-aj.left-ap-1}var ak=am?0:c(j).scrollLeft();if(aj.left+ah<ak+1){ah=ak-aj.left+1}ad.css({left:parseInt(ah)+"px",top:parseInt(ao)+"px"})};var I={};var M=function(ai,ah,ag){var af={element:ai.get(0),onkeypress:function(al,an,ak,am,ap,ao){if(Y&&Y(al,an,ak,am,ap,ao)===false){return false}if(an&&!ak&&!am&&ap&&!ao){var aj=an.toLowerCase();if(!I[aj]){return}I[aj]();return false}},onselection:function(aq,an,ak,al){var am=true,aj=null;if(aq){c.each(ak,function(ar,at){if(c(at).parents("a").length!=0){aj=X(ad,c(at).parents("a:first"));
return false}})}if(!an){am=false}else{if(aj){}else{if(al){}else{if(C!="selection"&&C!="top-selection"&&C!="bottom-selection"){am=false}else{if(aq){am=false}else{if(ak.length==1&&ak[0].nodeName=="IMG"){am=false}}}}}}if(!am){ad.closePopup();return}var ap;var ao=function(){var aw=ap.outerWidth();var av=ah.offset(),ar=c(ad.getElement()).offset();var au=an.left+parseInt(an.width/2)-parseInt(aw/2)+ar.left-av.left;var at=an.top+an.height+ar.top-av.top;ac(ap,ah,au,at)};ap=c(ad.openPopup());if(ap.hasClass("wysiwyg-popup")&&!ap.hasClass("wysiwyg-popuphover")||ap.data("special")!=(!!aj)){ap=c(ad.closePopup().openPopup())}if(!ap.hasClass("wysiwyg-popup")){ap.addClass("wysiwyg-popup wysiwyg-popuphover");if(aj){ap.empty().append(aj).data("special",true)}else{T(ap,true,function(){return ap.empty()},ao)}}ao()},hijackcontextmenu:(C=="selection")};if(ag){var ae=c("<div/>").addClass("wysiwyg-placeholder").html(ag).hide();ah.prepend(ae);af.onplaceholder=function(aj){if(aj){ae.show()}else{ae.hide()}}}var ad=wysiwyg(af);return ad};var O=c("<div/>").addClass("wysiwyg-container");if(W){O.addClass(W)}U.wrap(O);O=U.parent(".wysiwyg-container");var P=false;if(E){P=c("<div/>").addClass("wysiwyg-wrapper").click(function(){y.getElement().focus()});U.wrap(P);P=U.parent(".wysiwyg-wrapper")}var y=M(U,E?P:O,E);if(y.legacy){var U=c(y.getElement());U.addClass("wysiwyg-textarea");if(U.is(":visible")){U.width(O.width()-(U.outerWidth()-U.width()))}}else{c(y.getElement()).addClass("wysiwyg-editor")}var D={};c.each(V,function(ad,af){if(!af||!af.hotkey){return}var ae=N(ad);if(!ae){return}I[af.hotkey.toLowerCase()]=ae;D[ad]=ae});if(C!="selection"){var H=C=="top"||C=="top-selection";var ab=c("<div/>").addClass("wysiwyg-toolbar").addClass(H?"wysiwyg-toolbar-top":"wysiwyg-toolbar-bottom");T(ab,false,function(){var ad=c(y.openPopup());if(ad.hasClass("wysiwyg-popup")&&ad.hasClass("wysiwyg-popuphover")){ad=c(y.closePopup().openPopup())}if(!ad.hasClass("wysiwyg-popup")){ad.addClass("wysiwyg-popup")}return ad},function(ai,ah,ad){var ae=c(ah);var aj=ai.outerWidth();var ag=ae.offset().left-O.offset().left+parseInt(ae.width()/2)-parseInt(aj/2);var af=ae.offset().top-O.offset().top;if(H){af+=ae.outerHeight()}else{af-=ai.outerHeight()}if(ad){ag=ad.left;af=ad.top}ac(ai,O,ag,af)});if(H){O.prepend(ab)}else{O.append(ab)}}return{wysiwygeditor:y,$container:O}};c.fn.wysiwyg=function(y,A){if(!y||typeof(y)==="object"){y=c.extend({},y);return this.each(function(){var H=c(this);if(H.data("wysiwyg")){return}var E=y.classes,N=y.placeholder||H.attr("placeholder"),C=(y.toolbar&&(y.toolbar=="top"||y.toolbar=="top-selection"||y.toolbar=="bottom"||y.toolbar=="bottom-selection"||y.toolbar=="selection"))?y.toolbar:"top-selection",F=y.buttons,M=y.submit,O=y.selectImage,P=y.placeholderUrl||null,L=y.placeholderEmbed||null,B=y.maxImageSize||null,J=y.onImageUpload||null,D=y.forceImageUpload&&J,K=y.videoFromUrl||null,I=y.onKeyPress;var G=p(H,E,N,C,F,M,O,P,L,B,J,D,K,I);H.data("wysiwyg",G)})}else{if(this.length==1){var z=this.data("wysiwyg");if(!z){return this}if(y=="container"){return z.$container}if(y=="shell"){return z.wysiwygeditor}}}return this}}));